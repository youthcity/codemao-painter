{"version":3,"sources":["js/cursor-render.js","js/eraser-brush.js","js/layer-manager.js","js/layer.js","js/override/base-brush.js","js/override/canvas-events.js","js/override/canvas.js","js/override/pencil-brush.js","js/painter.js","js/point-brush.js","js/trim-canvas.js"],"names":[],"mappings":";;;;;;;AAKA,CAAC,YAAY;AACT,QAAG,CAAC,MAAD,EAAQ;AACP,eADO;KAAX;;AAIA,aAAS,cAAT,CAAyB,MAAzB,EAAiC,KAAjC,EAAwC,OAAxC,EAAiD;AAC7C,qBAD6C;;AAE7C,aAAK,MAAL,GAAc,MAAd,CAF6C;AAG7C,aAAK,KAAL,GAAa,KAAb,CAH6C;AAI7C,aAAK,GAAL,GAAW,OAAO,UAAP,CAAkB,IAAlB,CAAX,CAJ6C;;AAM7C,YAAG,OAAH,EAAY;AACR,iBAAK,KAAL,GAAa,QAAQ,KAAR,IAAiB,CAAjB,CADL;AAER,iBAAK,KAAL,GAAa,QAAQ,KAAR,IAAiB,OAAjB,CAFL;SAAZ,MAGK;AACD,iBAAK,KAAL,GAAa,CAAb,CADC;AAED,iBAAK,KAAL,GAAa,OAAb,CAFC;SAHL;KANJ;;AAeA,mBAAe,SAAf,CAAyB,gBAAzB,GAA4C,YAAW;AACnD,qBADmD;;AAEnD,YAAI,MAAM,KAAK,GAAL,CAFyC;AAGnD,YAAI,SAAJ,GAAgB,KAAK,KAAL,CAHmC;AAInD,YAAI,WAAJ,GAAkB,KAAK,KAAL,CAJiC;KAAX,CApBnC;;AA2BT,mBAAe,SAAf,CAAyB,YAAzB,GAAwC,UAAU,CAAV,EAAa,CAAb,EAAgB;AACpD,YAAI,MAAM,KAAK,GAAL;YACN,QAAQ,KAAK,KAAL,CAAW,KAAX,CAFwC;AAGpD,YAAI,SAAJ,GAAgB,uBAAhB,CAHoD;AAIpD,YAAI,SAAJ,GAAgB,CAAhB,CAJoD;AAKpD,YAAI,WAAJ,GAAkB,OAAlB,CALoD;AAMpD,YAAI,SAAJ,GANoD;AAOpD,YAAI,GAAJ,CAAQ,CAAR,EAAU,CAAV,EAAY,QAAQ,CAAR,EAAU,CAAtB,EAAwB,KAAK,EAAL,GAAQ,CAAR,EAAU,IAAlC,EAPoD;AAQpD,YAAI,MAAJ,GARoD;AASpD,YAAI,IAAJ;;;;AAToD,KAAhB,CA3B/B;;AA0CT,mBAAe,SAAf,CAAyB,WAAzB,GAAuC,UAAU,CAAV,EAAa,CAAb,EAAgB;AACnD,YAAI,MAAM,KAAK,GAAL,CADyC;AAEnD,YAAI,SAAJ,GAAgB,uBAAhB,CAFmD;AAGnD,YAAI,SAAJ,GAAgB,CAAhB,CAHmD;AAInD,YAAI,WAAJ,GAAkB,OAAlB,CAJmD;AAKnD,aAAI,IAAI,IAAI,CAAJ,EAAM,IAAI,EAAJ,EAAO,IAAE,IAAE,CAAF,EAAK;AACxB,gBAAI,SAAJ,GADwB;AAExB,gBAAI,GAAJ,CAAQ,CAAR,EAAU,CAAV,EAAY,EAAZ,EAAe,KAAK,EAAL,GAAQ,CAAR,GAAY,CAAZ,GAAc,EAAd,EAAiB,KAAK,EAAL,GAAQ,CAAR,IAAa,IAAE,CAAF,CAAb,GAAkB,EAAlB,EAAqB,KAArD,EAFwB;AAGxB,gBAAI,MAAJ,GAHwB;SAA5B;AAKA,YAAI,SAAJ,GAVmD;AAWnD,YAAI,GAAJ,CAAQ,CAAR,EAAU,CAAV,EAAY,EAAZ,EAAe,CAAf,EAAiB,KAAK,EAAL,GAAQ,CAAR,EAAU,IAA3B,EAXmD;AAYnD,YAAI,IAAJ,GAZmD;;AAcnD,YAAI,SAAJ,GAdmD;AAenD,YAAI,MAAJ,CAAW,CAAX,EAAa,IAAE,CAAF,CAAb,CAfmD;AAgBnD,YAAI,MAAJ,CAAW,CAAX,EAAa,IAAE,CAAF,CAAb,CAhBmD;AAiBnD,YAAI,MAAJ,GAjBmD;AAkBnD,YAAI,MAAJ,CAAW,IAAE,CAAF,EAAI,CAAf,EAlBmD;AAmBnD,YAAI,MAAJ,CAAW,IAAE,CAAF,EAAI,CAAf,EAnBmD;AAoBnD,YAAI,MAAJ;;;;;;AApBmD,KAAhB,CA1C9B;;AAsET,WAAO,cAAP,GAAwB,cAAxB,CAtES;CAAZ,CAAD;;;;;;;;;ACAA,CAAC,YAAW;;;;;;AAMV,SAAO,WAAP,GAAqB,OAAO,IAAP,CAAY,WAAZ,CACnB,OAAO,SAAP,4CAA6D;;;;;;;;AAQ7D,gBAAY,oBAAU,MAAV,EAAkB,OAAlB,EAA2B;AACrC,WAAK,MAAL,GAAc,MAAd,CADqC;AAErC,WAAK,cAAL,GAAsB,KAAK,MAAL,CAAY,oBAAZ,EAAtB,CAFqC;AAGrC,WAAK,aAAL,GAAqB,KAAK,cAAL,CAAoB,UAApB,CAA+B,IAA/B,CAArB,CAHqC;AAIrC,WAAK,MAAL,CAAY,gBAAZ,CAA6B,KAAK,MAAL,CAAY,aAAZ,EAA2B,KAAK,cAAL,CAAxD,CAJqC;AAKrC,WAAK,MAAL,CAAY,iBAAZ,CAA8B,KAAK,cAAL,CAA9B,CALqC;AAMrC,WAAK,aAAL,CAAmB,qBAAnB,GAA2C,KAA3C,CANqC;AAOrC,WAAK,MAAL,CAAY,iBAAZ,GAAgC,MAAhC,CAPqC;AAQrC,WAAK,OAAL,GAAe,EAAf,CARqC;AASrC,WAAK,WAAL,GAAmB,kBAAnB,CATqC;AAUrC,WAAK,KAAL,GAAa,EAAb;;;;;;;;;AAVqC,WAmBhC,IAAI,IAAJ,IAAY,OAAjB,EAA0B;AACxB,YAAI,QAAQ,cAAR,CAAuB,IAAvB,CAAJ,EAAkC;AAChC,eAAK,IAAL,IAAa,QAAQ,IAAR,CAAb,CADgC;SAAlC;OADF;;;AAnBqC,KAA3B;;;;;;AAgCZ,iBAAa,qBAAU,OAAV,EAAmB;AAC9B,WAAK,kBAAL,CAAwB,OAAxB;;;AAD8B,UAI9B,CAAK,mBAAL,CAAyB,OAAzB,EAJ8B;AAK9B,WAAK,OAAL,GAL8B;KAAnB;;;;;;AAYb,iBAAa,qBAAU,OAAV,EAAmB;AAC9B,WAAK,mBAAL,CAAyB,OAAzB;;;AAD8B,UAI9B,CAAK,MAAL,CAAY,YAAZ,CAAyB,KAAK,MAAL,CAAY,UAAZ,CAAzB,CAJ8B;AAK9B,WAAK,OAAL,GAL8B;KAAnB;;;;;AAWb,eAAW,qBAAY;AACrB,WAAK,mBAAL,GADqB;KAAZ;;AAIX,gBAAY,oBAAU,OAAV,EAAmB;AAC7B,WAAK,MAAL,CAAY,YAAZ,CAAyB,KAAK,MAAL,CAAY,aAAZ,CAAzB,CAD6B;KAAnB;;;;;;AAQZ,wBAAoB,4BAAU,OAAV,EAAmB;;AAErC,UAAI,IAAI,IAAI,OAAO,KAAP,CAAa,QAAQ,CAAR,EAAW,QAAQ,CAAR,CAAhC,CAFiC;;AAIrC,WAAK,MAAL,GAJqC;AAKrC,WAAK,SAAL,CAAe,CAAf,EALqC;;AAOrC,WAAK,MAAL,CAAY,YAAZ,CAAyB,KAAK,cAAL,CAAoB,UAApB,CAA+B,IAA/B,CAAzB,EAPqC;AAQrC,WAAK,aAAL,CAAmB,SAAnB,CAA6B,KAAK,MAAL,CAAY,aAAZ,EAA2B,CAAxD,EAA2D,CAA3D,EAA8D,KAAK,cAAL,CAAoB,KAApB,EAA2B,KAAK,cAAL,CAAoB,MAApB,CAAzF,CARqC;AASrC,WAAK,MAAL,CAAY,YAAZ,CAAyB,KAAK,MAAL,CAAY,gBAAZ,CAAzB,CATqC;AAUrC,WAAK,MAAL,CAAY,UAAZ,CAAuB,MAAvB,CAA8B,EAAE,CAAF,EAAK,EAAE,CAAF,CAAnC,CAVqC;;AAYrC,WAAK,cAAL,CAAoB,gBAApB,GAZqC;KAAnB;;;;;;AAmBpB,eAAW,mBAAU,KAAV,EAAiB;AAC1B,WAAK,OAAL,CAAa,IAAb,CAAkB,KAAlB,EAD0B;KAAjB;;;;;;AAQX,YAAQ,kBAAY;AAClB,WAAK,OAAL,CAAa,MAAb,GAAsB,CAAtB,CADkB;;AAGlB,WAAK,eAAL,GAHkB;AAIlB,WAAK,UAAL,GAJkB;KAAZ;;AAOR,qBAAiB,2BAAY;AAC3B,mBAD2B;;AAE3B,UAAI,MAAM,KAAK,MAAL,CAAY,UAAZ,CAFiB;AAG3B,UAAI,WAAJ,GAAkB,KAAK,WAAL,CAHS;AAI3B,UAAI,SAAJ,GAAgB,KAAK,KAAL,CAJW;AAK3B,UAAI,OAAJ,GAAc,KAAK,aAAL,CALa;AAM3B,UAAI,QAAJ,GAAe,KAAK,cAAL,CANY;AAO3B,UAAI,KAAK,eAAL,IAAwB,OAAO,YAAP,CAAoB,QAApB,CAA6B,aAA7B,CAAxB,EAAqE;AACvE,YAAI,WAAJ,CAAgB,KAAK,eAAL,CAAhB,CADuE;OAAzE;KAPe;;;;;;AAgBjB,yBAAqB,6BAAU,OAAV,EAAmB;AACtC,UAAI,eAAe,IAAI,OAAO,KAAP,CAAa,QAAQ,CAAR,EAAW,QAAQ,CAAR,CAA3C,CADkC;AAEtC,WAAK,SAAL,CAAe,YAAf,EAFsC;KAAnB;;;;;;AASrB,aAAS,mBAAY;AACnB,UAAI,MAAM,KAAK,MAAL,CAAY,UAAZ;UACR,IAAI,KAAK,MAAL,CAAY,iBAAZ;UACJ,KAAK,KAAK,OAAL,CAAa,CAAb,CAAL;UACA,KAAK,KAAK,OAAL,CAAa,CAAb,CAAL,CAJiB;;AAMnB,UAAI,IAAJ,GANmB;AAOnB,UAAI,SAAJ,CAAc,KAAK,cAAL,EAAqB,CAAnC,EAAsC,CAAtC,EAPmB;AAQnB,UAAI,wBAAJ,GAA+B,iBAA/B,CARmB;AASnB,UAAI,SAAJ,CAAc,EAAE,CAAF,CAAd,EAAoB,EAAE,CAAF,CAApB,EAA0B,EAAE,CAAF,CAA1B,EAAgC,EAAE,CAAF,CAAhC,EAAsC,EAAE,CAAF,CAAtC,EAA4C,EAAE,CAAF,CAA5C,EATmB;AAUnB,UAAI,SAAJ;;;;;;AAVmB,UAgBf,KAAK,OAAL,CAAa,MAAb,KAAwB,CAAxB,IAA6B,GAAG,CAAH,KAAS,GAAG,CAAH,IAAQ,GAAG,CAAH,KAAS,GAAG,CAAH,EAAM;AAC/D,WAAG,CAAH,IAAQ,GAAR,CAD+D;AAE/D,WAAG,CAAH,IAAQ,GAAR,CAF+D;OAAjE;AAIA,UAAI,MAAJ,CAAW,GAAG,CAAH,EAAM,GAAG,CAAH,CAAjB,CApBmB;;AAsBnB,WAAK,IAAI,IAAI,CAAJ,EAAO,MAAM,KAAK,OAAL,CAAa,MAAb,EAAqB,IAAI,GAAJ,EAAS,GAApD,EAAyD;;;AAGvD,YAAI,WAAW,GAAG,YAAH,CAAgB,EAAhB,CAAX,CAHmD;AAIvD,YAAI,gBAAJ,CAAqB,GAAG,CAAH,EAAM,GAAG,CAAH,EAAM,SAAS,CAAT,EAAY,SAAS,CAAT,CAA7C,CAJuD;;AAMvD,aAAK,KAAK,OAAL,CAAa,CAAb,CAAL,CANuD;AAOvD,aAAK,KAAK,OAAL,CAAa,IAAI,CAAJ,CAAlB,CAPuD;OAAzD;;;;AAtBmB,SAkCnB,CAAI,MAAJ,CAAW,GAAG,CAAH,EAAM,GAAG,CAAH,CAAjB,CAlCmB;AAmCnB,UAAI,MAAJ,GAnCmB;AAoCnB,UAAI,OAAJ,GApCmB;KAAZ;;;;;;;;;AA8CT,4BAAwB,gCAAU,MAAV,EAAkB;AACxC,UAAI,OAAO,EAAP;UACF,KAAK,IAAI,OAAO,KAAP,CAAa,OAAO,CAAP,EAAU,CAAV,EAAa,OAAO,CAAP,EAAU,CAAV,CAAnC;UACA,KAAK,IAAI,OAAO,KAAP,CAAa,OAAO,CAAP,EAAU,CAAV,EAAa,OAAO,CAAP,EAAU,CAAV,CAAnC,CAHsC;;AAKxC,WAAK,IAAL,CAAU,IAAV,EAAgB,OAAO,CAAP,EAAU,CAAV,EAAa,GAA7B,EAAkC,OAAO,CAAP,EAAU,CAAV,EAAa,GAA/C,EALwC;AAMxC,WAAK,IAAI,IAAI,CAAJ,EAAO,MAAM,OAAO,MAAP,EAAe,IAAI,GAAJ,EAAS,GAA9C,EAAmD;AACjD,YAAI,WAAW,GAAG,YAAH,CAAgB,EAAhB,CAAX;;;;AAD6C,YAKjD,CAAK,IAAL,CAAU,IAAV,EAAgB,GAAG,CAAH,EAAM,GAAtB,EAA2B,GAAG,CAAH,EAAM,GAAjC,EAAsC,SAAS,CAAT,EAAY,GAAlD,EAAuD,SAAS,CAAT,EAAY,GAAnE,EALiD;AAMjD,aAAK,IAAI,OAAO,KAAP,CAAa,OAAO,CAAP,EAAU,CAAV,EAAa,OAAO,CAAP,EAAU,CAAV,CAAnC,CANiD;AAOjD,YAAI,CAAC,GAAI,CAAJ,GAAS,OAAO,MAAP,EAAe;AAC3B,eAAK,IAAI,OAAO,KAAP,CAAa,OAAO,IAAI,CAAJ,CAAP,CAAc,CAAd,EAAiB,OAAO,IAAI,CAAJ,CAAP,CAAc,CAAd,CAAvC,CAD2B;SAA7B;OAPF;AAWA,WAAK,IAAL,CAAU,IAAV,EAAgB,GAAG,CAAH,EAAM,GAAtB,EAA2B,GAAG,CAAH,EAAM,GAAjC,EAjBwC;AAkBxC,aAAO,IAAP,CAlBwC;KAAlB;;;;;;;AA0BxB,gBAAY,oBAAU,QAAV,EAAoB;AAC9B,UAAI,OAAO,IAAI,OAAO,IAAP,CAAY,QAAhB,EAA0B;AACnC,cAAM,IAAN;AACA,gBAAQ,KAAK,KAAL;AACR,qBAAa,KAAK,KAAL;AACb,uBAAe,KAAK,aAAL;AACf,wBAAgB,KAAK,cAAL;AAChB,yBAAiB,KAAK,eAAL;AACjB,iBAAS,QAAT;AACA,iBAAS,QAAT;OARS,CAAP,CAD0B;;AAY9B,UAAI,KAAK,MAAL,EAAa;AACf,aAAK,MAAL,CAAY,YAAZ,GAA2B,IAA3B,CADe;AAEf,aAAK,SAAL,CAAe,KAAK,MAAL,CAAf,CAFe;OAAjB;;AAKA,aAAO,IAAP,CAjB8B;KAApB;;;;;;;AAyBZ,yBAAqB,+BAAY;AAC/B,UAAI,MAAM,KAAK,MAAL,CAAY,UAAZ;UACR,gBADF;UACQ,oBADR;UACkB,uBADlB;UAEE,SAAS,IAAT;UACA,eAAe,KAAK,MAAL,CAAY,YAAZ,CAAyB,YAAzB,CAJc;AAK/B,UAAI,SAAJ,GAL+B;AAM/B,iBAAW,uBAAuB,KAAK,MAAL,CAAY,aAAZ,CAAlC,CAN+B;AAO/B,aAAO,SAAS,MAAT,CAAgB,SAAhB,CAA0B,KAA1B,CAAP;;;;;;;;;;AAP+B,YAiB/B,CAAO,KAAP,CAAa,OAAb,CAAqB,IAArB,EAA2B,UAAU,KAAV,EAAiB;AAC1C,cAAM,GAAN,CAAU;AACN,gBAAM,SAAS,IAAT;AACN,eAAK,SAAS,GAAT;AACL,iBAAO,CAAP;SAHJ,EAKG,KALH,CAKS,CALT,EAMG,SANH,GAD0C;AAQ1C,gBAAQ,MAAR,CAAe,SAAf,CAAyB,QAAQ,MAAR,CAAzB,CAR0C;AAS1C,gBAAQ,MAAR,CAAe,QAAf,CAAwB,QAAQ,KAAR,CAAxB,CAT0C;AAU1C,gBAAQ,MAAR,CAAe,SAAf,GAV0C;AAW1C,gBAAQ,MAAR,CAAe,GAAf,CAAmB,KAAnB,EAX0C;AAY1C,eAAO,MAAP,CAAc,UAAd,CAAyB,qBAAzB,GAAiD,KAAjD,CAZ0C;AAa1C,eAAO,MAAP,CAAc,YAAd,CAA2B,OAAO,MAAP,CAAc,UAAd,CAA3B,CAb0C;AAc1C,qBAAa,OAAb,CAAqB,MAArB,CAA4B,CAA5B,EAA+B,aAAa,OAAb,CAAqB,MAArB,EAA6B,KAA5D,EAd0C;AAe1C,eAAO,MAAP,CAAc,SAAd,GAf0C;AAgB1C,eAAO,MAAP,CAAc,UAAd,CAAyB,qBAAzB,GAAiD,IAAjD,CAhB0C;OAAjB,CAA3B;;;;;;;;;;;;;;;;;;;;;;;AAjB+B,KAAZ;;AA4DrB,kBAAc,sBAAU,OAAV,EAAmB;AAC/B,WAAK,MAAL,CAAY,YAAZ,CAAyB,KAAK,MAAL,CAAY,aAAZ,CAAzB,CAD+B;AAE/B,WAAK,cAAL,CAAoB,YAApB,CAAiC,QAAQ,CAAR,EAAW,QAAQ,CAAR,CAA5C;;AAF+B,KAAnB;GApSK,CAArB,CANU;CAAX,CAAD;;;;;;;;ACAA,CAAC,UAAS,MAAT,EAAgB;AACb,iBADa;;AAGb,QAAG,CAAC,MAAD,EAAQ;AACP,eADO;KAAX;;AAIA,aAAS,YAAT,CAAsB,YAAtB,EAAoC;AAChC,aAAK,SAAL,GAAiB,EAAjB,CADgC;AAEhC,aAAK,YAAL,GAAoB,IAApB,CAFgC;AAGhC,aAAK,YAAL,GAAoB,YAApB,CAHgC;;AAKhC,YAAG,YAAH,EAAgB;AACZ,iBAAK,YAAL,GAAoB,IAAI,OAAO,KAAP,CAAa,aAAa,aAAb,CAArC,CADY;AAEZ,iBAAK,YAAL,CAAkB,OAAlB,GAA4B,aAAa,QAAb,CAFhB;AAGZ,iBAAK,QAAL,CAAc,KAAK,YAAL,CAAd,CAHY;SAAhB;KALJ;;AAYA,iBAAa,SAAb,CAAuB,QAAvB,GAAkC,UAAU,KAAV,EAAgB;AAC9C,YAAI,gBAAgB,KAAK,YAAL,CAAkB,aAAlB,CAD0B;;AAG9C,YAAG,CAAC,KAAD,EAAO;AACN,gBAAI,WAAW,KAAK,YAAL,CAAkB,oBAAlB,EAAX,CADE;AAEN,oBAAQ,IAAI,OAAO,KAAP,CAAa,QAAjB,CAAR,CAFM;SAAV,MAGO,IAAI,CAAC,MAAM,QAAN,EAAgB;AACxB,kBAAM,QAAN,GAAiB,IAAI,KAAK,YAAL,CAAkB,oBAAlB,EAArB,CADwB;SAArB;AAGP,aAAK,SAAL,CAAe,IAAf,CAAoB,KAApB,EAT8C;AAU9C,cAAM,MAAN,GAAe,IAAf,CAV8C;AAW9C,aAAK,YAAL,CAAkB,SAAlB,CAA4B,YAA5B,CAAyC,MAAM,QAAN,EAAgB,aAAzD,EAX8C;;AAa9C,aAAK,YAAL,CAAkB,gBAAlB,CAAmC,aAAnC,EAAkD,MAAM,QAAN,CAAlD,CAb8C;AAc9C,aAAK,YAAL,CAAkB,iBAAlB,CAAoC,MAAM,QAAN,CAApC,CAd8C;;AAgB9C,aAAK,WAAL,CAAiB,KAAK,SAAL,CAAe,MAAf,GAAwB,CAAxB,CAAjB,CAhB8C;KAAhB;;;;;;AAnBrB,gBA0Cb,CAAa,SAAb,CAAuB,WAAvB,GAAqC,UAAU,KAAV,EAAiB;AAClD,YAAG,QAAQ,KAAK,SAAL,CAAe,MAAf,IAAyB,KAAK,SAAL,CAAe,MAAf,GAAwB,CAAxB,EAA0B;AAC1D,gBAAG,KAAK,SAAL,CAAe,KAAf,MAA0B,KAAK,YAAL,EAAkB;AAC3C,oBAAG,UAAU,CAAV,EAAY;AACX,yBAAK,WAAL,CAAiB,CAAjB,EADW;iBAAf,MAEK;AACD,yBAAK,WAAL,CAAiB,QAAQ,CAAR,CAAjB,CADC;iBAFL;aADJ;AAOA,iBAAK,YAAL,CAAkB,SAAlB,CAA4B,WAA5B,CAAwC,KAAK,SAAL,CAAe,KAAf,EAAsB,QAAtB,CAAxC,CAR0D;AAS1D,iBAAK,SAAL,CAAe,MAAf,CAAsB,KAAtB,EAA4B,CAA5B,EAT0D;SAA9D;KADiC,CA1CxB;;AAwDb,iBAAa,SAAb,CAAuB,OAAvB,GAAiC,UAAU,KAAV,EAAiB;AAC9C,YAAG,UAAS,KAAK,SAAL,CAAe,MAAf,GAAwB,CAAxB,EAA0B;AAClC,iBAAK,SAAL,CAAe,QAAQ,CAAR,EAAW,KAA1B,EADkC;SAAtC;KAD6B;;;;;;;AAxDpB,gBAmEb,CAAa,SAAb,CAAuB,SAAvB,GAAmC,UAAU,IAAV,EAAgB,GAAhB,EAAqB;AACpD,YAAG,QAAQ,GAAR,EAAa;AACZ,mBADY;SAAhB;AAGA,YAAG,SAAS,KAAK,SAAL,CAAe,MAAf,GAAwB,CAAxB,EAA0B;AAClC,iBAAK,YAAL,CAAkB,SAAlB,CAA4B,YAA5B,CAAyC,KAAK,SAAL,CAAe,GAAf,EAAoB,QAApB,EAA8B,KAAK,YAAL,CAAkB,aAAlB,CAAvE,CADkC;SAAtC,MAEK;AACD,iBAAK,YAAL,CAAkB,SAAlB,CAA4B,YAA5B,CAAyC,KAAK,SAAL,CAAe,GAAf,EAAoB,QAApB,EAA8B,KAAK,SAAL,CAAe,IAAf,EAAqB,QAArB,CAAvE,CADC;SAFL;AAKA,aAAK,SAAL,CAAe,MAAf,CAAsB,IAAtB,EAA4B,CAA5B,EAA+B,KAAK,SAAL,CAAe,GAAf,CAA/B,EAToD;AAUpD,YAAG,OAAO,GAAP,EAAW;AACV,iBAAK,SAAL,CAAe,MAAf,CAAsB,GAAtB,EAA0B,CAA1B,EADU;SAAd,MAEK;AACD,iBAAK,SAAL,CAAe,MAAf,CAAsB,MAAM,CAAN,EAAQ,CAA9B,EADC;SAFL;KAV+B,CAnEtB;;AAoFb,iBAAa,SAAb,CAAuB,SAAvB,GAAmC,UAAU,KAAV,EAAgB;AAC/C,YAAG,UAAU,CAAV,EAAY;AACX,iBAAK,SAAL,CAAe,QAAQ,CAAR,EAAW,KAA1B,EADW;SAAf;KAD+B,CApFtB;;AA0Fb,iBAAa,SAAb,CAAuB,SAAvB,GAAmC,UAAU,KAAV,EAAiB;AAChD,YAAG,QAAO,KAAK,SAAL,CAAe,MAAf,EAAsB;AAC5B,iBAAK,SAAL,CAAe,KAAf,EAAsB,QAAtB,CAA+B,KAA/B,CAAqC,OAArC,GAA+C,IAA/C,CAD4B;AAE5B,iBAAI,IAAI,IAAI,CAAJ,EAAO,IAAI,KAAK,SAAL,CAAe,KAAf,EAAsB,OAAtB,CAA8B,MAA9B,EAAsC,EAAE,CAAF,EAAI;AACzD,qBAAK,SAAL,CAAe,KAAf,EAAsB,OAAtB,CAA8B,CAA9B,EAAiC,OAAjC,GAA2C,IAA3C,CADyD;aAA7D;AAGA,iBAAK,SAAL,CAAe,KAAf,EAAsB,OAAtB,GAAgC,IAAhC,CAL4B;AAM5B,iBAAK,YAAL,CAAkB,SAAlB,GAN4B;SAAhC;KAD+B,CA1FtB;;AAqGb,iBAAa,SAAb,CAAuB,SAAvB,GAAmC,UAAU,KAAV,EAAiB;AAChD,YAAG,QAAQ,KAAK,SAAL,CAAe,MAAf,EAAsB;AAC7B,iBAAK,SAAL,CAAe,KAAf,EAAsB,QAAtB,CAA+B,KAA/B,CAAqC,OAArC,GAA+C,MAA/C,CAD6B;AAE7B,iBAAI,IAAI,IAAI,CAAJ,EAAO,IAAI,KAAK,SAAL,CAAe,KAAf,EAAsB,OAAtB,CAA8B,MAA9B,EAAsC,EAAE,CAAF,EAAI;AACzD,qBAAK,SAAL,CAAe,KAAf,EAAsB,OAAtB,CAA8B,CAA9B,EAAiC,OAAjC,GAA2C,KAA3C,CADyD;aAA7D;AAGA,iBAAK,SAAL,CAAe,KAAf,EAAsB,OAAtB,GAAgC,KAAhC,CAL6B;AAM7B,iBAAK,YAAL,CAAkB,SAAlB;;AAN6B,SAAjC;KAD+B,CArGtB;;AAiHb,iBAAa,SAAb,CAAuB,kBAAvB,GAA4C,UAAU,KAAV,EAAiB;AACzD,YAAG,KAAK,SAAL,CAAe,KAAf,EAAsB,OAAtB,EAA+B;AAC9B,iBAAK,SAAL,CAAe,KAAf,EAD8B;SAAlC,MAEO;AACH,iBAAK,SAAL,CAAe,KAAf,EADG;SAFP;KADwC;;;;;AAjH/B,gBA4Hb,CAAa,SAAb,CAAuB,WAAvB,GAAqC,UAAU,KAAV,EAAiB;AAClD,YAAG,QAAQ,KAAK,SAAL,CAAe,MAAf,EAAuB;AAC9B,iBAAK,YAAL,CAAkB,yBAAlB,GAD8B;AAE9B,iBAAK,YAAL,CAAkB,SAAlB,GAF8B;AAG9B,iBAAK,YAAL,GAAoB,KAAK,SAAL,CAAe,KAAf,CAApB,CAH8B;AAI9B,iBAAK,YAAL,CAAkB,aAAlB,GAAkC,KAAK,YAAL,CAAkB,QAAlB,CAJJ;AAK9B,iBAAK,YAAL,CAAkB,gBAAlB,GAAqC,KAAK,YAAL,CAAkB,QAAlB,CAA2B,UAA3B,CAAsC,IAAtC,CAArC,CAL8B;AAM9B,iBAAK,YAAL,CAAkB,QAAlB,GAA6B,KAAK,YAAL,CAAkB,OAAlB,CANC;SAAlC;KADiC;;;;;AA5HxB,gBA0Ib,CAAa,SAAb,CAAuB,WAAvB,GAAqC,YAAY;AAC7C,aAAK,WAAL,CAAiB,CAAjB,EAD6C;AAE7C,aAAK,SAAL,CAAe,CAAf,EAF6C;AAG7C,eAAM,KAAK,SAAL,CAAe,MAAf,GAAwB,CAAxB,EAA2B;AAC7B,iBAAK,WAAL,CAAiB,CAAjB,EAD6B;SAAjC;KAHiC;;;;;AA1IxB,gBAqJb,CAAa,SAAb,CAAuB,gBAAvB,GAA0C,YAAY;AAClD,aAAK,WAAL,CAAiB,CAAjB,EADkD;AAElD,eAAM,KAAK,SAAL,CAAe,MAAf,GAAwB,CAAxB,EAA2B;AAC7B,iBAAK,YAAL,CAAkB,OAAlB,GAA4B,KAAK,YAAL,CAAkB,OAAlB,CAA0B,MAA1B,CAAiC,KAAK,SAAL,CAAe,CAAf,EAAkB,OAAlB,CAA7D,CAD6B;AAE7B,iBAAK,YAAL,CAAkB,QAAlB,GAA6B,KAAK,YAAL,CAAkB,OAAlB,CAFA;AAG7B,iBAAK,WAAL,CAAiB,CAAjB,EAH6B;SAAjC;KAFsC;;;;;;AArJ7B,gBAkKb,CAAa,SAAb,CAAuB,aAAvB,GAAuC,UAAU,MAAV,EAAkB;AACrD,aAAK,WAAL,CAAiB,OAAO,CAAP,CAAjB,EADqD;AAErD,eAAM,OAAO,MAAP,GAAgB,CAAhB,EAAmB;AACrB,gBAAG,OAAO,CAAP,IAAY,KAAK,SAAL,CAAe,MAAf,EAAsB;AACjC,qBAAK,YAAL,CAAkB,OAAlB,GAA4B,KAAK,YAAL,CAAkB,OAAlB,CAA0B,MAA1B,CAAiC,KAAK,SAAL,CAAe,OAAO,CAAP,CAAf,EAA0B,OAA1B,CAA7D,CADiC;AAEjC,qBAAK,YAAL,CAAkB,QAAlB,GAA6B,KAAK,YAAL,CAAkB,OAAlB,CAFI;AAGjC,qBAAK,WAAL,CAAiB,OAAO,CAAP,CAAjB,EAHiC;aAArC;SADJ;KAFmC,CAlK1B;;AA6Kb,WAAO,YAAP,GAAsB,YAAtB,CA7Ka;CAAhB,CAAD,CA8KG,MA9KH;;;;;;;;ACAA,CAAC,UAAU,MAAV,EAAkB;AACf,iBADe;;AAGf,QAAG,CAAC,MAAD,EAAQ;AACP,eADO;KAAX;;AAIA,aAAS,KAAT,CAAgB,QAAhB,EAA0B,IAA1B,EAAgC;AAC5B,aAAK,QAAL,GAAgB,QAAhB,CAD4B;AAE5B,aAAK,IAAL,GAAY,QAAQ,SAAS,MAAM,SAAN,CAAgB,KAAhB,EAAT,CAFQ;AAG5B,aAAK,MAAL,GAAc,IAAd,CAH4B;AAI5B,aAAK,OAAL,GAAe,EAAf;;AAJ4B,YAM5B,CAAK,OAAL,GAAe,IAAf,CAN4B;KAAhC;;AASA,UAAM,SAAN,CAAgB,KAAhB,GAAwB,CAAxB,CAhBe;;AAkBf,UAAM,SAAN,CAAgB,UAAhB,GAA6B,YAAY;AACrC,aAAK,SAAL,CAAe,KAAf,GAAuB,CAAvB,CADqC;KAAZ,CAlBd;;AAsBf,WAAO,KAAP,GAAe,KAAf,CAtBe;CAAlB,CAAD,CAuBG,MAvBH;;;;;;;;ACAA,CAAC,YAAW;AACR,iBADQ;;AAER,QAAG,CAAC,MAAD,EAAQ;AACP,eADO;KAAX;;AAIA,WAAO,SAAP,CAAiB,SAAjB,CAA2B,UAA3B,GAAwC,UAAU,OAAV,EAAmB;AACvD,aAAK,IAAI,IAAJ,IAAY,OAAjB,EAA0B;AACtB,gBAAG,QAAQ,cAAR,CAAuB,IAAvB,CAAH,EAAiC;AAC7B,qBAAK,IAAL,IAAa,QAAQ,IAAR,CAAb,CAD6B;aAAjC;SADJ;KADoC,CANhC;CAAX,CAAD;;;;;;;;ACAA,CAAC,YAAY;AACT,kBADS;;AAET,QAAG,CAAC,MAAD,EAAQ;AACP,eADO;KAAX;;AAIA,WAAO,MAAP,CAAc,SAAd,CAAwB,WAAxB,GAAsC,YAAY;AAC9C,aAAK,YAAL,GAAoB,KAAK,YAAL,CAAkB,IAAlB,CAAuB,IAAvB,CAApB,CAD8C;AAE9C,aAAK,YAAL,GAAoB,KAAK,YAAL,CAAkB,IAAlB,CAAuB,IAAvB,CAApB,CAF8C;AAG9C,aAAK,UAAL,GAAkB,KAAK,UAAL,CAAgB,IAAhB,CAAqB,IAArB,CAAlB,CAH8C;AAI9C,aAAK,WAAL,GAAmB,KAAK,WAAL,CAAiB,IAAjB,CAAsB,IAAtB,CAAnB,CAJ8C;AAK9C,aAAK,SAAL,GAAiB,KAAK,SAAL,CAAe,IAAf,CAAoB,IAApB,CAAjB,CAL8C;AAM9C,aAAK,UAAL,GAAkB,KAAK,UAAL,CAAgB,IAAhB,CAAqB,IAArB,CAAlB,CAN8C;AAO9C,aAAK,OAAL,GAAe,KAAK,OAAL,CAAa,IAAb,CAAkB,IAAlB,CAAf,CAP8C;AAQ9C,aAAK,QAAL,GAAgB,KAAK,QAAL,CAAc,IAAd,CAAmB,IAAnB,CAAhB,CAR8C;AAS9C,aAAK,YAAL,GAAoB,KAAK,YAAL,CAAkB,IAAlB,CAAuB,IAAvB,CAApB,CAT8C;AAU9C,aAAK,oBAAL,GAA4B,KAAK,oBAAL,CAA0B,IAA1B,CAA+B,IAA/B,CAA5B,CAV8C;AAW9C,aAAK,aAAL,GAAqB,KAAK,aAAL,CAAmB,IAAnB,CAAwB,IAAxB,CAArB,CAX8C;KAAZ,CAN7B;;AAoBT,WAAO,MAAP,CAAc,SAAd,CAAwB,WAAxB,GAAsC,UAAU,CAAV,EAAa;AAC/C,YAAG,KAAK,aAAL,EAAoB;AACnB,iBAAK,YAAL,CAAkB,KAAK,aAAL,CAAlB,CADmB;SAAvB;KADkC,CApB7B;CAAZ,CAAD;;;;;;;;ACAA,CAAC,UAAU,MAAV,EAAkB;AACf,iBADe;;AAEf,QAAI,CAAC,MAAD,EAAS;AACT,eADS;KAAb;;AAIA,WAAO,MAAP,CAAc,SAAd,CAAwB,UAAxB,GAAqC,UAAU,EAAV,EAAc,OAAd,EAAuB;AACxD,oBAAY,UAAU,EAAV,CAAZ,CADwD;;AAGxD,aAAK,WAAL,CAAiB,EAAjB,EAAqB,OAArB,EAHwD;AAIxD,aAAK,gBAAL,GAJwD;AAKxD,aAAK,kBAAL,GALwD;;AAOxD,aAAK,YAAL,GAAoB,IAAI,OAAO,YAAP,CAAoB,IAAxB,CAApB,CAPwD;KAAvB,CANtB;;AAgBf,WAAO,MAAP,CAAc,SAAd,CAAwB,gBAAxB,GAA2C,YAAW;AAClD,aAAK,iBAAL,GAAyB,IAAzB,CADkD;AAElD,aAAK,cAAL,GAAsB,IAAtB,CAFkD;AAGlD,aAAK,mBAAL,GAHkD;AAIlD,aAAK,kBAAL,GAJkD;AAKlD,aAAK,mBAAL;;;;;AALkD,YAUlD,CAAK,mBAAL,GAVkD;;AAYlD,aAAK,gBAAL,GAAwB,OAAO,WAAP,IAAsB,IAAI,OAAO,WAAP,CAAmB,IAAvB,CAAtB,CAZ0B;;AAclD,aAAK,UAAL,GAdkD;KAAX,CAhB5B;;AAiCf,WAAO,MAAP,CAAc,SAAd,CAAwB,SAAxB,GAAoC,YAAY;AAC5C,YAAI,iBAAiB,KAAK,gBAAL;YAAuB,YAA5C,CAD4C;;AAG5C,YAAI,KAAK,UAAL,IAAmB,KAAK,SAAL,IAAkB,CAAC,KAAK,cAAL,EAAqB;AAC3D,iBAAK,YAAL,CAAkB,KAAK,UAAL,CAAlB,CAD2D;SAA/D;;AAIA,aAAK,YAAL,CAAkB,cAAlB,EAP4C;;AAS5C,aAAK,IAAL,CAAU,eAAV,EAT4C;;AAW5C,YAAI,KAAK,MAAL,EAAa;AACb,mBAAO,IAAP,CAAY,WAAZ,CAAwB,IAAxB,EAA8B,cAA9B,EADa;SAAjB;AAGA,aAAK,iBAAL,CAAuB,cAAvB,EAd4C;;AAgB5C,uBAAe,IAAf,GAhB4C;AAiB5C,uBAAe,KAAK,sBAAL,EAAf;;AAjB4C,sBAmB5C,CAAe,SAAf,CAAyB,KAAzB,CAA+B,cAA/B,EAA+C,KAAK,iBAAL,CAA/C,CAnB4C;AAoB5C,aAAK,cAAL,CAAoB,cAApB,EAAoC,YAApC,EApB4C;AAqB5C,aAAK,sBAAL,IAA+B,KAAK,cAAL,CAAoB,cAApB,EAAoC,CAAC,KAAK,cAAL,EAAD,CAApC,CAA/B,CArB4C;AAsB5C,uBAAe,OAAf,GAtB4C;;AAwB5C,YAAI,CAAC,KAAK,oBAAL,IAA6B,KAAK,WAAL,EAAkB;AAChD,iBAAK,YAAL,CAAkB,cAAlB,EADgD;SAApD;AAGA,YAAI,KAAK,MAAL,EAAa;AACb,2BAAe,OAAf,GADa;SAAjB;AAGA,aAAK,cAAL,CAAoB,cAApB,EA9B4C;AA+B5C,YAAI,KAAK,oBAAL,IAA6B,KAAK,WAAL,EAAkB;AAC/C,iBAAK,YAAL,CAAkB,cAAlB,EAD+C;SAAnD;;AAIA,aAAK,IAAL,CAAU,cAAV,EAnC4C;AAoC5C,eAAO,IAAP,CApC4C;KAAZ,CAjCrB;;AAwEf,WAAO,MAAP,CAAc,SAAd,CAAwB,KAAxB,GAAgC,YAAY;AACxC,aAAK,YAAL,CAAkB,WAAlB,GADwC;AAExC,aAAK,QAAL,CAAc,MAAd,GAAuB,CAAvB,CAFwC;AAGxC,YAAI,KAAK,kBAAL,EAAyB;AACzB,iBAAK,kBAAL,GADyB;SAA7B;AAGA,YAAI,KAAK,mBAAL,EAA0B;AAC1B,iBAAK,mBAAL,GAD0B;SAA9B;AAGA,aAAK,YAAL,CAAkB,KAAK,gBAAL,CAAlB,CATwC;AAUxC,YAAI,KAAK,UAAL,EAAiB;AACjB,iBAAK,YAAL,CAAkB,KAAK,UAAL,CAAlB,CADiB;SAArB;AAGA,aAAK,IAAL,CAAU,gBAAV,EAbwC;AAcxC,aAAK,SAAL,GAdwC;AAexC,eAAO,IAAP,CAfwC;KAAZ,CAxEjB;;AA0Ff,WAAO,MAAP,CAAc,SAAd,CAAwB,mBAAxB,GAA8C,YAAY;AACtD,aAAK,cAAL,GAAsB,KAAK,oBAAL,EAAtB;;;;AADsD,YAKtD,CAAK,SAAL,CAAe,WAAf,CAA2B,KAAK,cAAL,CAA3B,CALsD;;AAOtD,aAAK,gBAAL,CAAsB,KAAK,aAAL,EAAoB,KAAK,cAAL,CAA1C,CAPsD;AAQtD,aAAK,iBAAL,CAAuB,KAAK,cAAL,CAAvB,CARsD;AAStD,aAAK,cAAL,CAAoB,KAApB,CAA0B,aAA1B,GAA0C,MAA1C,CATsD;;AAWtD,aAAK,aAAL,GAAqB,KAAK,cAAL,CAAoB,UAApB,CAA+B,IAA/B,CAArB,CAXsD;KAAZ,CA1F/B;;AAwGf,WAAO,MAAP,CAAc,SAAd,CAAwB,yBAAxB,GAAoD,UAAU,CAAV,EAAa;AAC7D,YAAI,MAAM,OAAO,IAAP,CAAY,eAAZ,CAA4B,KAAK,iBAAL,CAAlC;YACA,UAAU,OAAO,IAAP,CAAY,cAAZ,CAA2B,KAAK,UAAL,CAAgB,CAAhB,EAAmB,IAAnB,CAA3B,EAAqD,GAArD,CAAV,CAFyD;AAG7D,YAAI,KAAK,mBAAL,EAA0B;AAC1B,iBAAK,gBAAL,CAAsB,WAAtB,CAAkC,OAAlC,EAD0B;SAA9B;AAGA,YAAI,KAAK,gBAAL,CAAsB,cAAtB,EAAsC;AACtC,iBAAK,gBAAL,CAAsB,YAAtB,CAAmC,OAAnC,EADsC;SAA1C;;AAIA,aAAK,SAAL,CAAe,KAAK,iBAAL,CAAf,CAV6D;AAW7D,aAAK,IAAL,CAAU,YAAV,EAAwB,EAAC,GAAG,CAAH,EAAzB,EAX6D;;AAa7D,YAAI,SAAS,KAAK,UAAL,CAAgB,CAAhB,CAAT,CAbyD;AAc7D,YAAI,OAAO,MAAP,KAAkB,WAAlB,EAA+B;AAC/B,mBAAO,IAAP,CAAY,WAAZ,EAAyB,EAAC,GAAG,CAAH,EAAM,QAAQ,MAAR,EAAhC,EAD+B;SAAnC;KAdgD,CAxGrC;;AA2Hf,WAAO,MAAP,CAAc,SAAd,CAAwB,mBAAxB,GAA8C,UAAU,KAAV,EAAiB,OAAjB,EAA0B;AACpE,YAAI,SAAS,IAAT,CADgE;AAEpE,aAAK,YAAL,CAAkB,KAAK,UAAL,CAAlB,CAFoE;AAGpE,gBAAQ,KAAR;AACI,iBAAK,QAAL;AACI,oBAAI,KAAK,gBAAL,IACG,KAAK,gBAAL,YAAiC,OAAO,WAAP,EAAoB;AACxD,yBAAK,gBAAL,CAAsB,UAAtB,CAAiC,OAAjC,EADwD;iBAD5D,MAGO;AACH,yBAAK,gBAAL,GAAwB,IAAI,OAAO,WAAP,CAAmB,IAAvB,EAA6B,OAA7B,CAAxB,CADG;iBAHP;AAMA,sBAPJ;AADJ,iBASS,UAAL;AACI,oBAAG,KAAK,aAAL,EAAoB;AACnB,4BAAQ,KAAR,GAAgB;AACZ,2BAAG,KAAK,aAAL,CAAmB,CAAnB;AACH,2BAAG,KAAK,aAAL,CAAmB,CAAnB;qBAFP,CADmB;iBAAvB;AAMA,oBAAI,KAAK,gBAAL,IACG,KAAK,gBAAL,YAAiC,OAAO,UAAP,EAAmB;AACvD,yBAAK,gBAAL,CAAsB,UAAtB,CAAiC,OAAjC,EADuD;iBAD3D,MAGO;AACH,yBAAK,gBAAL,GAAwB,IAAI,OAAO,UAAP,CAAkB,IAAtB,EAA4B,UAAU,KAAV,EAAiB;AACjE,+BAAO,aAAP,GAAuB;AACnB,+BAAG,MAAM,CAAN;AACH,+BAAG,MAAM,CAAN;yBAFP,CADiE;qBAAjB,EAKjD,OALqB,CAAxB,CADG;iBAHP;AAWA,oBAAG,KAAK,aAAL,EAAoB;AACnB,yBAAK,gBAAL,CAAsB,WAAtB,GADmB;iBAAvB;AAGA,sBArBJ;AATJ,iBA+BS,QAAL,CA/BJ;AAgCI;AACI,oBAAI,EAAE,KAAK,gBAAL,IACC,KAAK,gBAAL,YAAiC,OAAO,WAAP,CADpC,EACyD;AACzD,yBAAK,gBAAL,GAAwB,IAAI,OAAO,WAAP,CAAmB,MAAvB,CAAxB,CADyD;iBAD7D;AAIA,qBAAK,IAAI,IAAJ,IAAY,OAAjB,EAA0B;AACtB,wBAAI,QAAQ,cAAR,CAAuB,IAAvB,CAAJ,EAAkC;AAC9B,6BAAK,gBAAL,CAAsB,IAAtB,IAA8B,QAAQ,IAAR,CAA9B,CAD8B;qBAAlC;iBADJ;AArCR,SAHoE;KAA1B,CA3H/B;;AA2Kf,WAAO,MAAP,CAAc,SAAd,CAAwB,cAAxB,GAAyC,UAAU,IAAV,EAAgB;AACrD,YAAI,CAAC,KAAK,gBAAL,IAAyB,KAAK,aAAL,KAAuB,IAAvB,EAA6B;AACvD,mBADuD;SAA3D;;AAIA,aAAK,YAAL,CAAkB,KAAK,UAAL,CAAlB,CALqD;AAMrD,YAAI,IAAJ,EAAU;AACN,iBAAK,aAAL,GAAqB,IAArB,CADM;AAEN,iBAAK,aAAL,CAAmB,gBAAnB,CAAoC,UAApC,EAAgD,KAAK,WAAL,CAAhD,CAFM;SAAV,MAGO;AACH,iBAAK,aAAL,GAAqB,KAArB,CADG;AAEH,iBAAK,aAAL,CAAmB,mBAAnB,CAAuC,UAAvC,EAAmD,KAAK,WAAL,CAAnD,CAFG;SAHP;KANqC,CA3K1B;CAAlB,CAAD,CA0LG,MA1LH;;;;;;;ACDA,CAAC,YAAW;AACR,iBADQ;;AAER,QAAG,CAAC,MAAD,EAAQ;AACP,eADO;KAAX;;AAIA,WAAO,WAAP,CAAmB,SAAnB,CAA6B,UAA7B,GAA0C,UAAU,MAAV,EAAkB;AACxD,aAAK,MAAL,GAAc,MAAd,CADwD;AAExD,aAAK,OAAL,GAAe,EAAf;;;AAFwD,YAKxD,CAAK,MAAL,CAAY,iBAAZ,GAAgC,MAAhC,CALwD;AAMxD,aAAK,cAAL,GAAsB,IAAI,OAAO,cAAP,CAAsB,KAAK,MAAL,CAAY,cAAZ,EAA4B,IAAtD,CAAtB,CANwD;KAAlB,CANlC;;AAeR,WAAO,WAAP,CAAmB,SAAnB,CAA6B,kBAA7B,GAAkD,UAAS,OAAT,EAAkB;;AAEhE,YAAI,IAAI,IAAI,OAAO,KAAP,CAAa,QAAQ,CAAR,EAAW,QAAQ,CAAR,CAAhC,CAF4D;;AAIhE,aAAK,MAAL,GAJgE;AAKhE,aAAK,SAAL,CAAe,CAAf,EALgE;;AAOhE,aAAK,MAAL,CAAY,UAAZ,CAAuB,MAAvB,CAA8B,EAAE,CAAF,EAAK,EAAE,CAAF,CAAnC,CAPgE;AAQhE,aAAK,cAAL,CAAoB,gBAApB,GARgE;KAAlB,CAf1C;;AA0BR,WAAO,WAAP,CAAmB,SAAnB,CAA6B,YAA7B,GAA4C,UAAU,OAAV,EAAmB;AAC3D,aAAK,MAAL,CAAY,YAAZ,CAAyB,KAAK,MAAL,CAAY,aAAZ,CAAzB,CAD2D;AAE3D,aAAK,cAAL,CAAoB,YAApB,CAAiC,QAAQ,CAAR,EAAW,QAAQ,CAAR,CAA5C,CAF2D;KAAnB,CA1BpC;CAAX,CAAD;;;ACJA,CAAC,YAAY;AACT,iBADS;;AAET,WAAO,OAAP,GAAiB;;AAEb,cAAM,cAAU,KAAV,EAAiB,MAAjB,EAAyB;AAC3B,gBAAI,kBAAkB,EAAE,kBAAF,CAAlB;gBACA,iBAAiB,EAAE,iBAAF,CAAjB;gBACA,oBAAoB,EAAE,oBAAF,CAApB;gBACA,SAAS,IAAT,CAJuB;;AAM3B,iBAAK,eAAL,GAAuB,eAAvB,CAN2B;AAO3B,iBAAK,UAAL,GAAkB,EAAE,aAAF,CAAlB,CAP2B;AAQ3B,iBAAK,WAAL,GAAmB,EAAE,cAAF,CAAnB;;;AAR2B,gBAWvB,CAAC,KAAD,EAAQ;AACR,wBAAQ,gBAAgB,KAAhB,KAA0B,EAAE,uBAAF,EAA2B,KAA3B,EAA1B,GAA+D,EAAE,wBAAF,EAA4B,KAA5B,EAA/D,GAAqG,EAArG,CADA;AAER,yBAAS,gBAAgB,MAAhB,KAA2B,EAAE,qBAAF,EAAyB,MAAzB,EAA3B,GAA+D,EAA/D,CAFD;aAAZ;AAIA,iBAAK,KAAL,GAAa,KAAb,CAf2B;AAgB3B,iBAAK,MAAL,GAAc,MAAd,CAhB2B;AAiB3B,2BAAe,IAAf,CAAoB,QAApB,EAA8B,MAA9B,EAjB2B;AAkB3B,2BAAe,IAAf,CAAoB,OAApB,EAA6B,KAA7B,EAlB2B;AAmB3B,gBAAI,SAAS,IAAI,OAAO,MAAP,CAAc,gBAAlB,CAAT,CAnBuB;AAoB3B,oBAAQ,MAAR,GAAiB,MAAjB,CApB2B;AAqB3B,mBAAO,mBAAP,GAA6B,KAA7B,CArB2B;;AAuB3B,8BAAkB,GAAlB,CAAsB,YAAtB,EAAoC,SAApC,EAvB2B;AAwB3B,8BAAkB,IAAlB;;;;AAxB2B,gBA4B3B,CAAK,EAAL,GAAU,IAAI,GAAJ,CAAQ;AACd,oBAAI,oBAAJ;AACA,sBAAM;AACF,2BAAO,EAAP;AACA,6BAAS,YAAT;AACA,0BAAM,QAAN;AACA,2BAAO,EAAP;iBAJJ;AAMA,uBAAO;AACH,+BAAW,iBAAU,KAAV,EAAiB;AACxB,4BAAI,SAAS,OAAO,eAAP,EAAT,CADoB;AAExB,4BAAI,CAAC,MAAD,EAAS,OAAb;;AAEA,+BAAO,GAAP,CAAW,MAAX,EAAmB,KAAnB,EAA0B,SAA1B,GAJwB;AAKxB,+BAAO,SAAP,GALwB;qBAAjB;AAOX,6BAAS,eAAU,KAAV,EAAiB;AACtB,4BAAI,YAAY,aAAZ,CADkB;AAEtB,gCAAQ,SAAS,KAAT,EAAgB,EAAhB,CAAR,CAFsB;AAGtB,4BAAI,OAAO,gBAAP,EAAyB;AACzB,mCAAO,gBAAP,CAAwB,KAAxB,GAAgC,SAAS,EAAT,CADP;yBAA7B;AAGA,4BAAI,SAAS,OAAO,eAAP,EAAT,CANkB;AAOtB,4BAAI,CAAC,MAAD,EAAS,OAAb;;AAEA,4BAAG,KAAK,IAAL,KAAc,MAAd,EAAsB;AACrB,wCAAY,UAAZ,CADqB;yBAAzB;AAGA,4BAAI,OAAO,kBAAP,IAA6B,OAAO,SAAP,EAAkB;AAC/C,gCAAI,QAAQ,EAAR,CAD2C;AAE/C,kCAAM,SAAN,IAAmB,KAAnB,CAF+C;AAG/C,mCAAO,kBAAP,CAA0B,KAA1B,EAH+C;AAI/C,mCAAO,SAAP,GAJ+C;yBAAnD,MAMK;AACD,mCAAO,SAAP,IAAoB,KAApB,CADC;yBANL;;AAUA,+BAAO,SAAP,GAtBsB;AAuBtB,+BAAO,SAAP,GAvBsB;qBAAjB;AAyBT,6BAAS,iBAAY;AACjB,oCAAY,KAAK,KAAL,CADK;;AAGjB,+BAAO,gBAAP,CAAwB,KAAxB,GAAgC,SAAhC,CAHiB;;AAKjB,4BAAI,eAAe,OAAO,eAAP,EAAf;4BACA,cAAc,OAAO,cAAP,EAAd,CANa;;AAQjB,4BAAI,WAAJ,EAAiB;AACb,gCAAI,iBAAiB,YAAY,UAAZ,EAAjB,CADS;AAEb,mCAAO,kBAAP,GAFa;AAGb,2CAAe,OAAf,CAAuB,UAAU,YAAV,EAAwB;AAC3C,oCAAI,aAAa,MAAb,EAAqB;AACrB,iDAAa,SAAb,CAAuB,SAAvB,EADqB;iCAAzB,MAEO;AACH,iDAAa,QAAb,CAAsB,SAAtB,EADG;iCAFP;6BADmB,CAAvB,CAHa;yBAAjB,MAWK,IAAI,YAAJ,EAAkB;AACnB,gCAAI,aAAa,MAAb,EAAqB;AACrB,6CAAa,SAAb,CAAuB,SAAvB,EADqB;6BAAzB,MAEO;AACH,6CAAa,QAAb,CAAsB,SAAtB,EADG;6BAFP;yBADC;AAOL,+BAAO,SAAP,GA1BiB;qBAAZ;iBAjCb;;;;;;AARc,aAAR,CAAV,CA5B2B;;AAyG3B,mBAAO,EAAP,CAAU,iBAAV,EAA6B,WAA7B,EAzG2B;;AA2G3B,qBAAS,WAAT,GAAuB;AACnB,oBAAI,SAAS,OAAO,eAAP,EAAT,CADe;AAEnB,oBAAI,CAAC,MAAD,EAAS,OAAb;;AAEA,uBAAO,EAAP,CAAU,OAAV,GAAoB,OAAO,MAAP,KAAkB,EAAlB,CAJD;AAKnB,oBAAG,OAAO,EAAP,CAAU,OAAV,KAAsB,EAAtB,EAA0B;AACzB,2BAAO,EAAP,CAAU,IAAV,GAAiB,MAAjB,CADyB;AAEzB,2BAAO,EAAP,CAAU,KAAV,GAAkB,OAAO,UAAP,CAAlB,CAFyB;iBAA7B,MAGK;AACD,2BAAO,EAAP,CAAU,IAAV,GAAiB,MAAjB,CADC;AAED,wBAAI,OAAO,gBAAP,EAAyB;AACzB,+BAAO,EAAP,CAAU,KAAV,GAAkB,OAAO,aAAP,CAAlB,CADyB;qBAA7B;iBALJ;aALJ;;AAiBA,qBAAS,aAAT,CAAuB,IAAvB,EAA6B;AACzB,oBAAI,SAAS,OAAO,eAAP,EAAT,CADqB;AAEzB,oBAAI,CAAC,MAAD,EAAS,OAAO,EAAP,CAAb;;AAEA,uBAAO,OAAO,IAAP,KAAgB,EAAhB,CAJkB;aAA7B;;;AA5H2B,qBAoIlB,UAAT,GAAsB;;AAElB,oBAAI,SAAU,CAAC,QAAD,EAAW,QAAX,EAAqB,QAArB,EAA+B,QAA/B,EAAwC,QAAxC,EAAkD,QAAlD,EAA4D,QAA5D,EACV,QADU,EACA,QADA,EACU,QADV,EACoB,QADpB,EAC8B,QAD9B,EACwC,QADxC,EACkD,QADlD,CAAV;;;;;;;;;AAFc,qBAYb,IAAI,IAAI,CAAJ,EAAO,IAAI,OAAO,MAAP,EAAe,EAAE,CAAF,EAAI;AACnC,sBAAE,sBAAF,EAA0B,MAA1B,CAAiC,SAAS,iBAAT,EAA4B,EAAC,OAAO,MAAM,OAAO,CAAP,CAAN,EAApC,CAAjC,EADmC;iBAAvC;aAZJ;;AAkBA,gBAAI,YAAY,EAAZ,CAtJuB;AAuJ3B,yBAvJ2B;;AAyJ3B,cAAE,cAAF,EAAkB,EAAlB,CAAqB,OAArB,EAA8B,YAAY;AACtC,oBAAI,CAAC,EAAE,IAAF,EAAQ,QAAR,CAAiB,QAAjB,CAAD,EAA6B;AAC7B,sBAAE,IAAF,EAAQ,MAAR,GAAiB,IAAjB,CAAsB,cAAtB,EAAsC,WAAtC,CAAkD,QAAlD,EAD6B;AAE7B,sBAAE,IAAF,EAAQ,QAAR,CAAiB,QAAjB,EAF6B;AAG7B,wBAAI,EAAE,IAAF,EAAQ,QAAR,CAAiB,gBAAjB,CAAJ,EAAwC;AACpC,+BAAO,gBAAP,CAAwB,KAAxB,GAAgC,EAAE,IAAF,EAAQ,IAAR,CAAa,YAAb,CAAhC,CADoC;AAEpC,oCAAY,EAAE,IAAF,EAAQ,IAAR,CAAa,YAAb,CAAZ,CAFoC;AAGpC,+BAAO,EAAP,CAAU,KAAV,GAAkB,SAAlB,CAHoC;;AAKpC,4BAAI,eAAe,OAAO,eAAP,EAAf;4BACA,cAAc,OAAO,cAAP,EAAd,CANgC;;AAQpC,4BAAI,WAAJ,EAAiB;AACb,gCAAI,iBAAiB,YAAY,UAAZ,EAAjB,CADS;AAEb,mCAAO,kBAAP,GAFa;AAGb,2CAAe,OAAf,CAAuB,UAAU,YAAV,EAAwB;AAC3C,oCAAI,aAAa,MAAb,EAAqB;AACrB,iDAAa,SAAb,CAAuB,SAAvB,EADqB;iCAAzB,MAEO;AACH,iDAAa,QAAb,CAAsB,SAAtB,EADG;iCAFP;6BADmB,CAAvB,CAHa;yBAAjB,MAWK,IAAI,YAAJ,EAAkB;AACnB,gCAAI,aAAa,MAAb,EAAqB;AACrB,6CAAa,SAAb,CAAuB,SAAvB,EADqB;6BAAzB,MAEO;AACH,6CAAa,QAAb,CAAsB,SAAtB,EADG;6BAFP;yBADC;AAOL,+BAAO,SAAP,GA1BoC;qBAAxC;iBAHJ;aAD0B,CAA9B,CAzJ2B;AA2L3B,qBAAS,OAAT,GAAmB;AACf,uBAAO,GAAP,CAAW,IAAI,OAAO,IAAP,CAAY,CAAE,EAAF,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,CAAhB,EAAsC;AAC7C,0BAAM,KAAK,MAAL,KAAgB,OAAO,KAAP;AACtB,yBAAK,KAAK,MAAL,KAAgB,OAAO,MAAP;AACrB,4BAAQ,SAAR;AACA,iCAAa,OAAO,EAAP,CAAU,KAAV;iBAJN,CAAX,EADe;aAAnB;AAQA,qBAAS,OAAT,CAAiB,KAAjB,EAAwB,MAAxB,EAAgC,CAAhC,EAAmC,CAAnC,EAAsC;AAClC,oBAAI,OAAO,IAAI,OAAO,IAAP,CAAY;AACvB,yBAAK,CAAL;AACA,0BAAM,CAAN;AACA,2BAAO,KAAP;AACA,4BAAQ,MAAR;AACA,0BAAM,OAAO,gBAAP,CAAwB,KAAxB;iBALC,CAAP,CAD8B;AAQlC,uBAAO,GAAP,CAAW,IAAX,EARkC;aAAtC;;AAWA,qBAAS,SAAT,CAAmB,MAAnB,EAA2B,CAA3B,EAA8B,CAA9B,EAAiC;AAC7B,uBAAO,GAAP,CAAW,IAAI,OAAO,MAAP,CAAc;AACzB,0BAAM,CAAN;AACA,yBAAK,CAAL;AACA,0BAAM,OAAO,gBAAP,CAAwB,KAAxB;AACN,4BAAQ,EAAR;;AAJyB,iBAAlB,CAAX,EAD6B;aAAjC;;AAUA,qBAAS,WAAT,CAAqB,KAArB,EAA4B,MAA5B,EAAoC,CAApC,EAAuC,CAAvC,EAA0C;AACtC,uBAAO,GAAP,CAAW,IAAI,OAAO,QAAP,CAAgB;AAC3B,0BAAM,CAAN;AACA,yBAAK,CAAL;AACA,0BAAM,OAAO,gBAAP,CAAwB,KAAxB;AACN,2BAAO,KAAP;AACA,4BAAQ,MAAR;iBALO,CAAX,EADsC;aAA1C;;AAUA,qBAAS,QAAT,CAAkB,IAAlB,EAAwB,CAAxB,EAA2B,CAA3B,EAA8B,KAA9B,EAAqC;AACjC,uBAAO,KAAP,CAAa,OAAb,CAAqB,IAArB,EAA2B,UAAU,KAAV,EAAiB;AACxC,0BAAM,GAAN,CAAU;AACN,8BAAM,KAAK,CAAL;AACN,6BAAK,KAAK,CAAL;AACL,+BAAO,CAAP;qBAHJ,EAKK,KALL,CAKW,CALX,EAMK,SANL,GADwC;AAQxC,4BAAQ,MAAR,CAAe,GAAf,CAAmB,KAAnB,EARwC;AASxC,4BAAQ,MAAR,CAAe,SAAf,GATwC;iBAAjB,CAA3B,CADiC;aAArC;;AAcA,oBAAQ,QAAR,GAAmB,QAAnB,CAhP2B;;AAkP3B,qBAAS,OAAT,CAAiB,CAAjB,EAAoB,CAApB,EAAuB;AACnB,6BADmB;;AAEnB,oBAAI,OAAO,2BAAP,CAFe;;AAInB,oBAAI,aAAa,IAAI,OAAO,IAAP,CAAY,IAAhB,EAAsB;AACnC,0BAAM,KAAK,OAAO,QAAP,KAAoB,CAApB;AACX,yBAAK,KAAK,OAAO,SAAP,KAAqB,CAArB;AACV,gCAAY,iBAAZ;AACA,2BAAO,CAAP;AACA,0BAAM,OAAO,gBAAP,CAAwB,KAAxB;AACN,4BAAQ,CAAR;AACA,4BAAQ,CAAR;AACA,gCAAY,EAAZ;AACA,6BAAS,MAAT;AACA,sCAAkB,IAAlB;AACA,qCAAiB,IAAjB;iBAXa,CAAb,CAJe;;AAkBnB,wBAAQ,MAAR,CAAe,GAAf,CAAmB,UAAnB,EAlBmB;aAAvB;;AAqBA,qBAAS,cAAT,GAA0B;AACtB,oBAAI,eAAe,OAAO,eAAP,EAAf;oBACA,cAAc,OAAO,cAAP,EAAd,CAFkB;;AAItB,oBAAI,WAAJ,EAAiB;AACb,wBAAI,iBAAiB,YAAY,UAAZ,EAAjB,CADS;AAEb,2BAAO,kBAAP,GAFa;AAGb,mCAAe,OAAf,CAAuB,UAAU,MAAV,EAAkB;AACrC,+BAAO,MAAP,CAAc,MAAd,EADqC;qBAAlB,CAAvB,CAHa;iBAAjB,MAOK,IAAI,YAAJ,EAAkB;AACnB,2BAAO,MAAP,CAAc,YAAd,EADmB;iBAAlB;aAXT;;AAgBA,qBAAS,cAAT,GAA0B;AAClB,uBAAO,aAAP,GADkB;AAElB,uBAAO,SAAP;;AAFkB,aAA1B;;AAMA,qBAAS,UAAT,GAAsB;AAClB,oBAAI,aAAa,OAAO,UAAP;oBACb,aAAa,EAAE,aAAF,CAAb;oBACA,eAAe,EAAE,eAAF,CAAf,CAHc;AAIlB,kBAAE,6BAAF,EAAiC,KAAjC,GAJkB;AAKlB,2BAAW,EAAX,CAAc,OAAd,EAAuB,YAAY;AAC/B,qCAD+B;AAE/B,2BAAO,mBAAP,CAA2B,QAA3B,EAAqC;AACjC,+BAAO,EAAP;AACA,+BAAO,SAAP;qBAFJ,EAF+B;AAM/B,2BAAO,cAAP,CAAsB,IAAtB,EAN+B;AAO/B,2BAAO,EAAP,CAAU,KAAV,GAAkB,EAAlB;;;AAP+B,iBAAZ,CAAvB,CALkB;AAgBlB,2BAAW,EAAX,CAAc,OAAd,EAAuB,YAAY;AAC/B,qCAD+B;AAE/B,2BAAO,mBAAP,CAA2B,QAA3B,EAAqC;AACjC,+BAAO,EAAP;AACA,+BAAO,SAAP;qBAFJ,EAF+B;AAM/B,2BAAO,cAAP,CAAsB,IAAtB,EAN+B;AAO/B,2BAAO,EAAP,CAAU,KAAV,GAAkB,EAAlB,CAP+B;iBAAZ,CAAvB,CAhBkB;AAyBlB,6BAAa,EAAb,CAAgB,OAAhB,EAAyB,YAAY;AACjC,qCADiC;AAEjC,2BAAO,cAAP,CAAsB,IAAtB,EAFiC;AAGjC,2BAAO,mBAAP,CAA2B,UAA3B,EAAuC,EAAvC,EAHiC;iBAAZ,CAAzB,CAzBkB;AA8BlB,kBAAE,aAAF,EAAiB,EAAjB,CAAoB,OAApB,EAA6B,YAAY;AACrC,2BAAO,WAAP,CAAmB,KAAnB,GADqC;AAErC,8BAAU,GAAV,EAAe,GAAf,EAAoB,GAApB,EAFqC;iBAAZ,CAA7B,CA9BkB;AAmClB,kBAAE,WAAF,EAAe,EAAf,CAAkB,OAAlB,EAA2B,YAAY;AACnC,2BAAO,WAAP,CAAmB,KAAnB,GADmC;AAEnC,4BAAQ,GAAR,EAAa,GAAb,EAAkB,GAAlB,EAAuB,GAAvB,EAFmC;iBAAZ,CAA3B,CAnCkB;AAuClB,kBAAE,WAAF,EAAe,EAAf,CAAkB,OAAlB,EAA2B,YAAY;AACnC,2BAAO,WAAP,CAAmB,KAAnB,GADmC;AAEnC,8BAFmC;iBAAZ,CAA3B,CAvCkB;AA2ClB,kBAAE,eAAF,EAAmB,EAAnB,CAAsB,OAAtB,EAA+B,YAAY;AACvC,2BAAO,WAAP,CAAmB,KAAnB,GADuC;AAEvC,gCAAY,GAAZ,EAAiB,GAAjB,EAAsB,GAAtB,EAA2B,GAA3B,EAFuC;iBAAZ,CAA/B,CA3CkB;AA+ClB,kBAAE,WAAF,EAAe,EAAf,CAAkB,OAAlB,EAA2B,YAAY;AACnC,2BAAO,WAAP,CAAmB,KAAnB,GADmC;AAEnC,4BAAQ,CAAR,EAAU,CAAV,EAFmC;iBAAZ,CAA3B,CA/CkB;;AAoDlB,2BAAY,KAAZ,GApDkB;AAqDlB,kBAAE,qBAAF,EAAyB,EAAzB,CAA4B,OAA5B,EAAqC,cAArC,EArDkB;AAsDlB,uBAAO,WAAP,CAAmB,EAAnB,CAAsB,OAAtB,EAA+B,YAAY;AACvC,2BAAO,cAAP,CAAsB,KAAtB,EADuC;iBAAZ,CAA/B,CAtDkB;AAyDlB,kBAAE,oBAAF,EAAwB,EAAxB,CAA2B,OAA3B,EAAoC,YAAY;AAC5C,2BAAO,cAAP,CAAsB,KAAtB,EAD4C;AAE5C,sBAAE,oBAAF,EAAwB,IAAxB,GAF4C;iBAAZ,CAApC,CAzDkB;AA6DlB,kBAAE,oBAAF,EAAwB,EAAxB,CAA2B,OAA3B,EAAoC,YAAY;AAC5C,wBAAI,MAAJ;wBAAY,IAAZ;wBAAkB,QAAQ,EAAR;;;AAD0B,0BAI5C,CAAO,cAAP,CAAsB,KAAtB;;AAJ4C,0BAM5C,CAAO,YAAP,CAAoB,gBAApB,GAN4C;AAO5C,wBAAI,YAAY,QAAQ,MAAR,CAAe,eAAf,EAAZ,CAPwC;AAQ5C,wBAAI,cAAc,OAAO,cAAP,EAAd,CARwC;AAS5C,wBAAI,WAAJ,EAAiB;AACb,4BAAI,iBAAiB,YAAY,UAAZ,EAAjB,CADS;AAEb,+BAAO,kBAAP,GAFa;AAGb,uCAAe,OAAf,CAAuB,UAAU,MAAV,EAAkB;AACrC,mCAAO,MAAP,GAAgB,KAAhB,CADqC;yBAAlB,CAAvB,CAHa;qBAAjB;AAOA,wBAAI,SAAJ,EAAe;AACX,kCAAU,MAAV,GAAmB,KAAnB,CADW;qBAAf;AAGA,2BAAO,SAAP,GAnB4C;AAoB5C,2BAAO,OAAP,CAAe,CAAf;;;;AApB4C,wBAyB5C,GAAO,SAAS,aAAT,CAAuB,QAAvB,CAAP,CAzB4C;AA0B5C,yBAAK,KAAL,GAAa,OAAO,aAAP,CAAqB,KAArB,CA1B+B;AA2B5C,yBAAK,MAAL,GAAc,OAAO,aAAP,CAAqB,MAArB,CA3B8B;AA4B5C,yBAAK,UAAL,CAAgB,IAAhB,EAAsB,SAAtB,CAAgC,OAAO,aAAP,EAAsB,CAAtD,EAAyD,CAAzD,EA5B4C;AA6B5C,0BAAM,GAAN,GAAY,IAAZ,CA7B4C;AA8B5C,0BAAM,GAAN,GAAY,KAAK,SAAL,EAAZ,CA9B4C;AA+B5C,0BAAM,EAAN,GAAW,OAAO,aAAP,CA/BiC;AAgC5C,0BAAM,IAAN,GAAa,EAAE,eAAF,EAAmB,GAAnB,EAAb,CAhC4C;;AAkC5C,wBAAG,OAAO,QAAP,EAAgB;AACf,+BAAO,QAAP,CAAgB,KAAhB,EADe;qBAAnB;;AAIA,sBAAE,oBAAF,EAAwB,IAAxB,GAtC4C;iBAAZ,CAApC,CA7DkB;aAAtB;;AAuGA,yBApY2B;;AAsY3B,qBAAS,QAAT,GAAoB;AAChB,oBAAI,MAAJ,CADgB;;AAGhB,uBAAO,YAAP,CAAoB,gBAApB,GAHgB;AAIhB,oBAAI,YAAY,QAAQ,MAAR,CAAe,eAAf,EAAZ,CAJY;AAKhB,oBAAI,cAAc,OAAO,cAAP,EAAd,CALY;AAMhB,oBAAI,WAAJ,EAAiB;AACb,wBAAI,iBAAiB,YAAY,UAAZ,EAAjB,CADS;AAEb,2BAAO,kBAAP,GAFa;AAGb,mCAAe,OAAf,CAAuB,UAAU,MAAV,EAAkB;AACrC,+BAAO,MAAP,GAAgB,KAAhB,CADqC;qBAAlB,CAAvB,CAHa;iBAAjB;AAOA,oBAAI,SAAJ,EAAe;AACX,8BAAU,MAAV,GAAmB,KAAnB,CADW;iBAAf;AAGA,wBAAQ,MAAR,CAAe,SAAf,GAhBgB;AAiBhB,wBAAQ,MAAR,CAAe,OAAf,CAAuB,CAAvB,EAjBgB;AAkBhB,oBAAI,OAAO,OAAO,SAAP,CAAiB,KAAjB,CAAP,CAlBY;AAmBhB,oBAAI,MAAM,SAAS,aAAT,CAAuB,KAAvB,CAAN,CAnBY;AAoBhB,oBAAI,YAAJ,CAAiB,OAAjB,EAA0B,KAA1B,EApBgB;AAqBhB,oBAAI,YAAJ,CAAiB,QAAjB,EAA2B,MAA3B,EArBgB;AAsBhB,oBAAI,YAAJ,CAAiB,KAAjB,EAAwB,IAAxB,EAtBgB;AAuBhB,oBAAI,IAAI,SAAS,aAAT,CAAuB,QAAvB,CAAJ,CAvBY;AAwBhB,kBAAE,YAAF,CAAe,OAAf,EAAwB,KAAxB,EAxBgB;AAyBhB,kBAAE,YAAF,CAAe,QAAf,EAAyB,MAAzB,EAzBgB;AA0BhB,oBAAI,MAAM,EAAE,UAAF,CAAa,IAAb,CAAN,CA1BY;AA2BhB,oBAAI,SAAJ,CAAc,GAAd,EAAmB,CAAnB,EAAsB,CAAtB,EAAyB,KAAzB,EAAgC,MAAhC,EA3BgB;AA4BhB,uBAAO,OAAP,CAAe,CAAf,EA5BgB;;AA8BhB,yBAAS,uBAAuB,CAAvB,EAA0B,OAAO,aAAP,CAAnC,CA9BgB;AA+BhB,uBAAO,MAAP,CA/BgB;aAApB;SAtYE;;;;;;;;AA+aN,gBAAQ,gBAAU,GAAV,EAAe,IAAf,EAAqB,OAArB,EAA8B;AAClC,gBAAI,QAAQ,CAAR;gBAAW,SAAS,CAAT;gBACX,IAAI,KAAK,MAAL,CAAY,KAAZ,GAAkB,CAAlB;gBACJ,IAAG,KAAK,MAAL,CAAY,MAAZ,GAAmB,CAAnB,CAH2B;AAIlC,gBAAG,OAAH,EAAY;AACR,wBAAQ,QAAQ,KAAR,CADA;AAER,yBAAS,QAAQ,MAAR,CAFD;AAGR,qBAAK,MAAL,CAAY,aAAZ,GAA4B;AACxB,uBAAG,KAAC,GAAQ,KAAK,MAAL,CAAY,KAAZ,GAAmB,CAA5B,GAA8B,QAAQ,cAAR,CAAuB,CAAvB,GAA2B,CAAC,KAAK,MAAL,CAAY,KAAZ,GAAoB,KAApB,CAAD,GAA6B,CAA7B;AAC5D,uBAAG,MAAC,GAAS,KAAK,MAAL,CAAY,MAAZ,GAAoB,CAA9B,GAAgC,QAAQ,cAAR,CAAuB,CAAvB,GAA2B,CAAC,KAAK,MAAL,CAAY,MAAZ,GAAqB,MAArB,CAAD,GAA+B,CAA/B;iBAFlE,CAHQ;AAOR,qBAAK,MAAL,CAAY,QAAZ,GAAuB,QAAQ,QAAR,CAPf;aAAZ;AASA,iBAAK,MAAL,CAAY,KAAZ,GAbkC;;AAelC,cAAE,eAAF,EAAmB,GAAnB,CAAuB,IAAvB,EAfkC;;AAiBlC,iBAAK,MAAL,CAAY,SAAZ,CAAsB,KAAK,MAAL,CAAtB,CAjBkC;AAkBlC,iBAAK,MAAL,CAAY,QAAZ,CAAqB,KAAK,KAAL,CAArB,CAlBkC;AAmBlC,iBAAK,MAAL,CAAY,SAAZ,GAnBkC;AAoBlC,iBAAK,QAAL,CAAc,GAAd,EAAmB,CAAC,KAAK,MAAL,CAAY,KAAZ,GAAoB,KAApB,CAAD,GAA6B,CAA7B,EAAgC,CAAC,KAAK,MAAL,CAAY,MAAZ,GAAqB,MAArB,CAAD,GAA+B,CAA/B,CAAnD,CApBkC;;AAsBlC,iBAAK,UAAL,CAAgB,KAAhB,GAtBkC;AAuBlC,cAAE,oBAAF,EAAwB,IAAxB,GAvBkC;SAA9B;;AA0BR,iBAAS,mBAAY;AACjB,cAAE,oBAAF,EAAwB,IAAxB,GADiB;SAAZ;KA3cb,CAFS;CAAZ,EAAD;;;;;;;;ACKA,CAAC,YAAY;;;;;;;AAOT,WAAO,UAAP,GAAoB,OAAO,IAAP,CAAY,WAAZ,CAAwB,OAAO,SAAP;;AAExC;;;;;;;;;AASI,oBAAY,oBAAU,MAAV,EAAkB,QAAlB,EAA4B,OAA5B,EAAqC;AAC7C,iBAAK,MAAL,GAAc,MAAd,CAD6C;AAE7C,iBAAK,QAAL,GAAgB,QAAhB,CAF6C;AAG7C,iBAAK,MAAL,CAAY,iBAAZ,GAAgC,MAAhC,CAH6C;AAI7C,iBAAK,KAAL,GAAa,CAAb,CAJ6C;;AAM7C,iBAAK,IAAI,IAAJ,IAAY,OAAjB,EAA0B;AACtB,oBAAI,QAAQ,cAAR,CAAuB,IAAvB,CAAJ,EAAkC;AAC9B,yBAAK,IAAL,IAAa,QAAQ,IAAR,CAAb,CAD8B;iBAAlC;aADJ;AAKA,iBAAK,cAAL,GAAsB,IAAI,OAAO,cAAP,CAAsB,KAAK,MAAL,CAAY,cAAZ,EAA4B,IAAtD,CAAtB,CAX6C;AAY7C,iBAAK,cAAL,CAAoB,KAApB,GAA4B,KAAK,KAAL,CAZiB;SAArC;;;;;;AAmBZ,qBAAa,qBAAU,OAAV,EAAmB;AAC5B,iBAAK,kBAAL,CAAwB,OAAxB,EAD4B;AAE5B,iBAAK,KAAL,GAAa,OAAb;;;;AAF4B,gBAM5B,CAAK,OAAL,CAAa,OAAb,EAN4B;SAAnB;;;;;;AAab,qBAAa,qBAAU,OAAV,EAAmB;;;;AAI5B,iBAAK,MAAL,CAAY,YAAZ,CAAyB,KAAK,MAAL,CAAY,UAAZ,CAAzB,CAJ4B;AAK5B,iBAAK,KAAL,GAAa,OAAb,CAL4B;AAM5B,iBAAK,OAAL,CAAa,OAAb,EAN4B;SAAnB;;;;;AAYb,mBAAW,qBAAY;AACnB,iBAAK,oBAAL,GADmB;SAAZ;;;;;;AAQX,4BAAoB,4BAAU,OAAV,EAAmB;;AAEnC,iBAAK,MAAL,GAFmC;AAGnC,iBAAK,MAAL,CAAY,YAAZ,CAAyB,KAAK,MAAL,CAAY,UAAZ,CAAzB,CAHmC;AAInC,iBAAK,cAAL,CAAoB,gBAApB,GAJmC;SAAnB;;;;;;AAWpB,gBAAQ,kBAAY;AAChB,iBAAK,eAAL,GADgB;AAEhB,iBAAK,UAAL,GAFgB;SAAZ;;AAKR,yBAAiB,2BAAY;AACzB,yBADyB;;AAEzB,gBAAI,MAAM,KAAK,MAAL,CAAY,UAAZ,CAFe;AAGzB,gBAAI,SAAJ,GAAgB,KAAK,KAAL,CAHS;AAIzB,gBAAI,OAAJ,GAAc,KAAK,aAAL,CAJW;AAKzB,gBAAI,QAAJ,GAAe,KAAK,cAAL,CALU;AAMzB,gBAAI,KAAK,eAAL,IAAwB,OAAO,YAAP,CAAoB,QAApB,CAA6B,aAA7B,CAAxB,EAAqE;AACrE,oBAAI,WAAJ,CAAgB,KAAK,eAAL,CAAhB,CADqE;aAAzE;SANa;;;;;;AAejB,iBAAS,iBAAU,OAAV,EAAmB;AACxB,gBAAI,MAAM,KAAK,MAAL,CAAY,UAAZ;gBACN,IAAI,KAAK,MAAL,CAAY,iBAAZ;gBACJ,IAAI,QAAQ,CAAR;gBACJ,IAAI,QAAQ,CAAR,CAJgB;AAKxB,gBAAI,SAAJ,GAAgB,CAAhB,CALwB;AAMxB,gBAAI,IAAJ,GANwB;AAOxB,gBAAI,SAAJ,CAAc,EAAE,CAAF,CAAd,EAAoB,EAAE,CAAF,CAApB,EAA0B,EAAE,CAAF,CAA1B,EAAgC,EAAE,CAAF,CAAhC,EAAsC,EAAE,CAAF,CAAtC,EAA4C,EAAE,CAAF,CAA5C,EAPwB;AAQxB,gBAAI,SAAJ,GAAgB,uBAAhB,CARwB;AASxB,gBAAI,WAAJ,GAAkB,iBAAlB,CATwB;AAUxB,gBAAI,SAAJ,GAVwB;AAWxB,gBAAI,GAAJ,CAAQ,CAAR,EAAW,CAAX,EAAc,EAAd,EAAkB,CAAlB,EAAqB,KAAK,EAAL,GAAU,CAAV,CAArB,CAXwB;AAYxB,gBAAI,MAAJ,GAZwB;AAaxB,gBAAI,IAAJ,GAbwB;AAcxB,gBAAI,SAAJ,GAAgB,CAAhB,CAdwB;AAexB,gBAAI,MAAJ,CAAW,CAAX,EAAc,CAAd,EAfwB;AAgBxB,gBAAI,MAAJ,CAAW,CAAX,EAAc,KAAK,MAAL,CAAY,MAAZ,CAAd,CAhBwB;AAiBxB,gBAAI,MAAJ,GAjBwB;AAkBxB,gBAAI,MAAJ,CAAW,CAAX,EAAc,CAAd,EAlBwB;AAmBxB,gBAAI,MAAJ,CAAW,KAAK,MAAL,CAAY,KAAZ,EAAmB,CAA9B,EAnBwB;AAoBxB,gBAAI,MAAJ,GApBwB;SAAnB;;;;;;;AA4BT,8BAAsB,gCAAY;AAC9B,yBAD8B;;AAE9B,gBAAI,KAAK,QAAL,EAAe;AACf,qBAAK,QAAL,CAAc,KAAK,KAAL,CAAd,CADe;aAAnB;SAFkB;;AAOtB,sBAAc,sBAAU,OAAV,EAAmB;AAC7B,iBAAK,MAAL,CAAY,YAAZ,CAAyB,KAAK,MAAL,CAAY,aAAZ,CAAzB,CAD6B;AAE7B,iBAAK,cAAL,CAAoB,WAApB,CAAgC,QAAQ,CAAR,EAAW,QAAQ,CAAR,CAA3C;;AAF6B,SAAnB;;AAMd,qBAAa,uBAAY;AACrB,yBADqB;;AAErB,iBAAK,OAAL,CAAa,KAAK,KAAL,CAAb,CAFqB;SAAZ;;KAvID,CAApB,CAPS;CAAZ,CAAD;;;ACLA,CAAC,YAAY;AACT,WAAO,WAAP,GAAqB,UAAU,CAAV,EAAa;;AAE9B,eAAO,UAAU,CAAV,EAAa,MAAb,CAFuB;KAAb;;;;;;;;AADZ,UAYT,CAAO,sBAAP,GAAgC,UAAU,CAAV,EAAa,EAAb,EAAiB;AAC7C,qBAD6C;;AAE7C,YAAI,SAAS,UAAU,CAAV,EAAa,EAAb,CAAT,CAFyC;AAG7C,YAAG,EAAH,EAAO;AACH,eAAG,CAAH,GAAO,GAAG,CAAH,GAAO,OAAO,KAAP,CAAa,IAAb,CADX;AAEH,eAAG,CAAH,GAAO,GAAG,CAAH,GAAO,OAAO,KAAP,CAAa,GAAb,CAFX;SAAP;;;AAH6C,eAStC;AACH,oBAAQ,OAAO,MAAP;AACR,kBAAM,OAAO,KAAP,CAAa,IAAb;AACN,iBAAK,OAAO,KAAP,CAAa,GAAb;AACL,gBAAI,EAAJ;SAJJ,CAT6C;KAAjB,CAZvB;;AA6BT,aAAS,YAAT,CAAsB,CAAtB,EAAyB,EAAzB,EAA6B;AACzB,YAAI,MAAM,EAAE,UAAF,CAAa,IAAb,CAAN;YACA,SAAS,IAAI,YAAJ,CAAiB,CAAjB,EAAoB,CAApB,EAAuB,EAAE,KAAF,EAAS,EAAE,MAAF,CAAzC;YACA,IAAI,OAAO,IAAP,CAAY,MAAZ;YACJ,CAHJ;YAII,QAAQ;AACJ,iBAAK,IAAL;AACA,kBAAM,IAAN;AACA,mBAAO,IAAP;AACA,oBAAQ,IAAR;SAJJ;YAMA,CAVJ;YAUO,CAVP,CADyB;;AAazB,aAAK,IAAI,CAAJ,EAAO,IAAI,CAAJ,EAAO,KAAK,CAAL,EAAQ;AACvB,gBAAI,OAAO,IAAP,CAAY,IAAI,CAAJ,CAAZ,KAAuB,CAAvB,EAA0B;AAC1B,oBAAI,CAAC,GAAI,CAAJ,GAAS,EAAE,KAAF,CADY;AAE1B,oBAAI,EAAC,EAAE,CAAC,GAAI,CAAJ,GAAS,EAAE,KAAF,CAAZ,CAFqB;;AAI1B,oBAAI,MAAM,GAAN,KAAc,IAAd,EAAoB;AACpB,0BAAM,GAAN,GAAY,CAAZ,CADoB;iBAAxB;;AAIA,oBAAI,MAAM,IAAN,KAAe,IAAf,EAAqB;AACrB,0BAAM,IAAN,GAAa,CAAb,CADqB;iBAAzB,MAEO,IAAI,IAAI,MAAM,IAAN,EAAY;AACvB,0BAAM,IAAN,GAAa,CAAb,CADuB;iBAApB;;AAIP,oBAAI,MAAM,KAAN,KAAgB,IAAhB,EAAsB;AACtB,0BAAM,KAAN,GAAc,CAAd,CADsB;iBAA1B,MAEO,IAAI,MAAM,KAAN,GAAc,CAAd,EAAiB;AACxB,0BAAM,KAAN,GAAc,CAAd,CADwB;iBAArB;;AAIP,oBAAI,MAAM,MAAN,KAAiB,IAAjB,EAAuB;AACvB,0BAAM,MAAN,GAAe,CAAf,CADuB;iBAA3B,MAEO,IAAI,MAAM,MAAN,GAAe,CAAf,EAAkB;AACzB,0BAAM,MAAN,GAAe,CAAf,CADyB;iBAAtB;aAtBX;SADJ;;AA6BA,YAAG,EAAH,EAAM;AACF,gBAAI,MAAM,GAAN,GAAY,GAAG,CAAH,EAAM;AAClB,sBAAM,GAAN,GAAY,GAAG,CAAH,CADM;aAAtB;AAGA,gBAAI,MAAM,MAAN,GAAe,GAAG,CAAH,EAAM;AACrB,sBAAM,MAAN,GAAe,GAAG,CAAH,CADM;aAAzB;AAGA,gBAAI,MAAM,IAAN,GAAa,GAAG,CAAH,EAAM;AACnB,sBAAM,IAAN,GAAa,GAAG,CAAH,CADM;aAAvB;AAGA,gBAAI,MAAM,KAAN,GAAc,GAAG,CAAH,EAAM;AACpB,sBAAM,KAAN,GAAc,GAAG,CAAH,CADM;aAAxB;SAVJ;;AAeA,cAAM,GAAN,GAAY,KAAK,GAAL,CAAS,MAAM,GAAN,GAAY,EAAZ,EAAgB,CAAzB,CAAZ,CAzDyB;AA0DzB,cAAM,MAAN,GAAe,KAAK,GAAL,CAAS,MAAM,MAAN,GAAe,EAAf,EAAmB,EAAE,MAAF,CAA3C,CA1DyB;AA2DzB,cAAM,IAAN,GAAa,KAAK,GAAL,CAAS,MAAM,IAAN,GAAa,EAAb,EAAiB,CAA1B,CAAb,CA3DyB;AA4DzB,cAAM,KAAN,GAAc,KAAK,GAAL,CAAS,MAAM,KAAN,GAAc,EAAd,EAAkB,EAAE,KAAF,CAAzC,CA5DyB;;AA8DzB,eAAO,KAAP,CA9DyB;KAA7B;;AAiEA,aAAS,SAAT,CAAoB,CAApB,EAAuB,EAAvB,EAA2B;AACvB,qBADuB;;AAEvB,YAAI,OAAO,SAAS,aAAT,CAAuB,QAAvB,EAAiC,UAAjC,CAA4C,IAA5C,CAAP,CAFmB;AAGvB,YAAI,QAAQ,aAAa,CAAb,EAAgB,EAAhB,CAAR,CAHmB;AAIvB,YAAI,aAAa,MAAM,MAAN,GAAe,MAAM,GAAN;YAC5B,YAAY,MAAM,KAAN,GAAc,MAAM,IAAN,CALP;;AAOvB,aAAK,qBAAL,GAA6B,KAA7B,CAPuB;AAQvB,aAAK,MAAL,CAAY,KAAZ,GAAoB,SAApB,CARuB;AASvB,aAAK,MAAL,CAAY,MAAZ,GAAqB,UAArB,CATuB;AAUvB,aAAK,SAAL,CAAe,CAAf,EAAkB,MAAM,IAAN,EAAY,MAAM,GAAN,EAAW,SAAzC,EAAoD,UAApD,EACI,CADJ,EACO,CADP,EACU,SADV,EACqB,UADrB,EAVuB;AAYvB,eAAO;AACH,oBAAQ,KAAK,MAAL;AACR,mBAAO,KAAP;SAFJ,CAZuB;KAA3B;CA9FH,CAAD","file":"js-es5","sourcesContent":["/**\n * Created by greendou on 16/4/9.\n * Renderer of Cursor (Mostly for Pencil&Eraser)\n */\n\n(function () {\n    if(!fabric){\n        return;\n    }\n\n    function CursorRenderer (canvas, brush, options) {\n        \"use strict\";\n        this.canvas = canvas;\n        this.brush = brush;\n        this.ctx = canvas.getContext('2d');\n\n        if(options) {\n            this.width = options.width || 1;\n            this.color = options.color || 'black';\n        }else{\n            this.width = 1;\n            this.color = 'black';\n        }\n    }\n\n    CursorRenderer.prototype.prepareForRender = function() {\n        \"use strict\";\n        var ctx = this.ctx;\n        ctx.lineWidth = this.width;\n        ctx.strokeStyle = this.color;\n    };\n\n    CursorRenderer.prototype.renderCircle = function (x, y) {\n        var ctx = this.ctx,\n            width = this.brush.width;\n        ctx.fillStyle = 'rgba(255,255,255,0.5)';\n        ctx.lineWidth = 1;\n        ctx.strokeStyle = 'black';\n        ctx.beginPath();\n        ctx.arc(x,y,width / 2,0,Math.PI*2,true);\n        ctx.stroke();\n        ctx.fill();\n        //ctx.beginPath();\n        //ctx.moveTo(width / 2 , 0);\n        //ctx.lineTo(width / 2, width);\n    };\n\n    CursorRenderer.prototype.renderPoint = function (x, y) {\n        var ctx = this.ctx;\n        ctx.fillStyle = 'rgba(255,255,255,0.5)';\n        ctx.lineWidth = 1;\n        ctx.strokeStyle = 'black';\n        for(var i = 0;i < 20;i=i+2) {\n            ctx.beginPath();\n            ctx.arc(x,y,20,Math.PI*2 * i/20,Math.PI*2 * (i+1)/20,false);\n            ctx.stroke();\n        }\n        ctx.beginPath();\n        ctx.arc(x,y,20,0,Math.PI*2,true);\n        ctx.fill();\n\n        ctx.beginPath();\n        ctx.moveTo(x,y-1);\n        ctx.lineTo(x,y+1);\n        ctx.stroke();\n        ctx.moveTo(x-1,y);\n        ctx.lineTo(x+1,y);\n        ctx.stroke();\n\n        //ctx.fill();\n        //ctx.beginPath();\n        //ctx.moveTo(width / 2 , 0);\n        //ctx.lineTo(width / 2, width);\n    };\n\n    fabric.CursorRenderer = CursorRenderer;\n})();\n","/**\n * Created by GreenDou on 16/4/9.\n * Eraser Brush\n */\n\n(function (){\n  /**\n   * EraserBrush class\n   * @class fabric.EraserBrush\n   * @extends fabric.BaseBrush\n   */\n  fabric.EraserBrush = fabric.util.createClass(\n    fabric.BaseBrush, /** @lends fabric.PencilBrush.prototype */ {\n\n    /**\n     * Constructor\n     * @param {fabric.Canvas} canvas\n     * @param options\n     * @return {fabric.PencilBrush} Instance of a pencil brush\n     */\n    initialize: function (canvas, options) {\n      this.canvas = canvas;\n      this.backupCanvasEl = this.canvas._createCanvasElement();\n      this.backupContext = this.backupCanvasEl.getContext('2d');\n      this.canvas._copyCanvasStyle(this.canvas.upperCanvasEl, this.backupCanvasEl);\n      this.canvas._applyCanvasStyle(this.backupCanvasEl);\n      this.backupContext.imageSmoothingEnabled = false;\n      this.canvas.freeDrawingCursor = 'none';\n      this._points = [];\n      this.strokeStyle = 'rgb(255,255,255)';\n      this.width = 10;\n      //  init options\n\n      //  Dynamic events\n      //  this.onMouseOut = this.onMouseOut.bind(this);\n      //  this.events = {\n      //    mouseout: this.canvas._onMouseOut\n      //  };\n\n      for (let prop in options) {\n        if (options.hasOwnProperty(prop)) {\n          this[prop] = options[prop];\n        }\n      }\n\n      // this.cursorRenderer = new fabric.CursorRenderer(this.canvas.cursorCanvasEl, this);\n    },\n\n    /**\n     * Inovoked on mouse down\n     * @param {Object} pointer\n     */\n    onMouseDown: function (pointer) {\n      this._prepareForDrawing(pointer);\n      // capture coordinates immediately\n      // this allows to draw dots (when movement never occurs)\n      this._captureDrawingPath(pointer);\n      this._render();\n    },\n\n    /**\n     * Inovoked on mouse move\n     * @param {Object} pointer\n     */\n    onMouseMove: function (pointer) {\n      this._captureDrawingPath(pointer);\n      // redraw curve\n      // clear top canvas\n      this.canvas.clearContext(this.canvas.contextTop);\n      this._render();\n    },\n\n    /**\n     * Invoked on mouse up\n     */\n    onMouseUp: function () {\n      this._finalizeAndAddPath();\n    },\n\n    onMouseOut: function (options) {\n      this.canvas.clearContext(this.canvas.contextCursor);\n    },\n\n    /**\n     * @private\n     * @param {Object} pointer Actual mouse position related to the canvas.\n     */\n    _prepareForDrawing: function (pointer) {\n\n      let p = new fabric.Point(pointer.x, pointer.y);\n\n      this._reset();\n      this._addPoint(p);\n\n      this.canvas.clearContext(this.backupCanvasEl.getContext('2d'));\n      this.backupContext.drawImage(this.canvas.lowerCanvasEl, 0, 0, this.backupCanvasEl.width, this.backupCanvasEl.height);\n      this.canvas.clearContext(this.canvas.contextContainer);\n      this.canvas.contextTop.moveTo(p.x, p.y);\n\n      this.cursorRenderer.prepareForRender();\n    },\n\n    /**\n     * @private\n     * @param {fabric.Point} point Point to be added to points array\n     */\n    _addPoint: function (point) {\n      this._points.push(point);\n    },\n\n    /**\n     * Clear points array and set contextTop canvas style.\n     * @private\n     */\n    _reset: function () {\n      this._points.length = 0;\n\n      this._setBrushStyles();\n      this._setShadow();\n    },\n\n    _setBrushStyles: function () {\n      \"use strict\";\n      let ctx = this.canvas.contextTop;\n      ctx.strokeStyle = this.strokeStyle;\n      ctx.lineWidth = this.width;\n      ctx.lineCap = this.strokeLineCap;\n      ctx.lineJoin = this.strokeLineJoin;\n      if (this.strokeDashArray && fabric.StaticCanvas.supports(\"setLineDash\")) {\n        ctx.setLineDash(this.strokeDashArray);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Object} pointer Actual mouse position related to the canvas.\n     */\n    _captureDrawingPath: function (pointer) {\n      let pointerPoint = new fabric.Point(pointer.x, pointer.y);\n      this._addPoint(pointerPoint);\n    },\n\n    /**\n     * Draw a smooth path on the topCanvas using quadraticCurveTo\n     * @private\n     */\n    _render: function () {\n      let ctx = this.canvas.contextTop,\n        v = this.canvas.viewportTransform,\n        p1 = this._points[0],\n        p2 = this._points[1];\n\n      ctx.save();\n      ctx.drawImage(this.backupCanvasEl, 0, 0);\n      ctx.globalCompositeOperation = 'destination-out';\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      ctx.beginPath();\n\n      //if we only have 2 points in the path and they are the same\n      //it means that the user only clicked the canvas without moving the mouse\n      //then we should be drawing a dot. A path isn't drawn between two identical dots\n      //that's why we set them apart a bit\n      if (this._points.length === 2 && p1.x === p2.x && p1.y === p2.y) {\n        p1.x -= 0.5;\n        p2.x += 0.5;\n      }\n      ctx.moveTo(p1.x, p1.y);\n\n      for (let i = 1, len = this._points.length; i < len; i++) {\n        // we pick the point between pi + 1 & pi + 2 as the\n        // end point and p1 as our control point.\n        let midPoint = p1.midPointFrom(p2);\n        ctx.quadraticCurveTo(p1.x, p1.y, midPoint.x, midPoint.y);\n\n        p1 = this._points[i];\n        p2 = this._points[i + 1];\n      }\n      // Draw last line as a straight line while\n      // we wait for the next point to be able to calculate\n      // the bezier control point\n      ctx.lineTo(p1.x, p1.y);\n      ctx.stroke();\n      ctx.restore();\n    },\n\n    /**\n     * Converts points to SVG path\n     * @param {Array} points Array of points\n     * @param {Number} minX\n     * @param {Number} minY\n     * @return {String} SVG path\n     */\n    convertPointsToSVGPath: function (points) {\n      let path = [],\n        p1 = new fabric.Point(points[0].x, points[0].y),\n        p2 = new fabric.Point(points[1].x, points[1].y);\n\n      path.push('M ', points[0].x, ' ', points[0].y, ' ');\n      for (let i = 1, len = points.length; i < len; i++) {\n        let midPoint = p1.midPointFrom(p2);\n        // p1 is our bezier control point\n        // midpoint is our endpoint\n        // start point is p(i-1) value.\n        path.push('Q ', p1.x, ' ', p1.y, ' ', midPoint.x, ' ', midPoint.y, ' ');\n        p1 = new fabric.Point(points[i].x, points[i].y);\n        if ((i + 1) < points.length) {\n          p2 = new fabric.Point(points[i + 1].x, points[i + 1].y);\n        }\n      }\n      path.push('L ', p1.x, ' ', p1.y, ' ');\n      return path;\n    },\n\n    /**\n     * Creates fabric.Path object to add on canvas\n     * @param {String} pathData Path data\n     * @return {fabric.Path} Path to add on canvas\n     */\n    createPath: function (pathData) {\n      let path = new fabric.Path(pathData, {\n        fill: null,\n        stroke: this.color,\n        strokeWidth: this.width,\n        strokeLineCap: this.strokeLineCap,\n        strokeLineJoin: this.strokeLineJoin,\n        strokeDashArray: this.strokeDashArray,\n        originX: 'center',\n        originY: 'center'\n      });\n\n      if (this.shadow) {\n        this.shadow.affectStroke = true;\n        path.setShadow(this.shadow);\n      }\n\n      return path;\n    },\n\n    /**\n     * On mouseup after drawing the path on contextTop canvas\n     * we use the points captured to create an new fabric path object\n     * and add it to the fabric canvas.\n     */\n    _finalizeAndAddPath: function () {\n      let ctx = this.canvas.contextTop,\n        data, trimData, layerObject,\n        myself = this,\n        currentLayer = this.canvas.layerManager.currentLayer;\n      ctx.closePath();\n      trimData = trimCanvasWithPosition(this.canvas.upperCanvasEl);\n      data = trimData.canvas.toDataURL('png');\n      //img=document.createElement('img');\n      //img.setAttribute('src',data);\n      //layerObject = new fabric.Image(img, {\n      //    left: 0,\n      //    top: 0,\n      //    angle: 0,\n      //    opacity: 1\n      //}).setCoords();\n\n      fabric.Image.fromURL(data, function (image) {\n        image.set({\n            left: trimData.left,\n            top: trimData.top,\n            angle: 0\n          })\n          .scale(1)\n          .setCoords();\n        Painter.canvas.setHeight(Painter.height);\n        Painter.canvas.setWidth(Painter.width);\n        Painter.canvas.renderAll();\n        Painter.canvas.add(image);\n        myself.canvas.contextTop.imageSmoothingEnabled = false;\n        myself.canvas.clearContext(myself.canvas.contextTop);\n        currentLayer.objects.splice(0, currentLayer.objects.length, image);\n        myself.canvas.renderAll();\n        myself.canvas.contextTop.imageSmoothingEnabled = true;\n      });\n\n\n      //let pathData = this.convertPointsToSVGPath(this._points).join('');\n      //if (pathData === 'M 0 0 Q 0 0 0 0 L 0 0') {\n      //    // do not create 0 width/height paths, as they are\n      //    // rendered inconsistently across browsers\n      //    // Firefox 4, for example, renders a dot,\n      //    // whereas Chrome 10 renders nothing\n      //    this.canvas.renderAll();\n      //    return;\n      //}\n      //\n      //let path = this.createPath(pathData);\n      //\n      //this.canvas.add(path);\n      //path.setCoords();\n      //\n      //this.canvas.clearContext(this.canvas.contextTop);\n      //this._resetShadow();\n      //this.canvas.renderAll();\n      //\n      //// fire event 'path' created\n      //this.canvas.fire('path:created', { path: path });\n    },\n\n    cursorRender: function (pointer) {\n      this.canvas.clearContext(this.canvas.contextCursor);\n      this.cursorRenderer.renderCircle(pointer.x, pointer.y);\n      //this.canvas.contextTop.drawImage(this.canvas.cursorCanvasEl,0,0);\n    }\n  });\n})();\n","/**\n * Created by GreenDou on 16/4/7.\n * LayerManager Class\n */\n\n(function(fabric){\n    \"use strict\";\n\n    if(!fabric){\n        return;\n    }\n\n    function LayerManager(parentCanvas) {\n        this.layerList = [];\n        this.currentLayer = null;\n        this.parentCanvas = parentCanvas;\n\n        if(parentCanvas){\n            this.currentLayer = new fabric.Layer(parentCanvas.lowerCanvasEl);\n            this.currentLayer.objects = parentCanvas._objects;\n            this.addLayer(this.currentLayer);\n        }\n    }\n\n    LayerManager.prototype.addLayer = function (layer){\n        var upperCanvasEl = this.parentCanvas.upperCanvasEl;\n\n        if(!layer){\n            var canvasEl = this.parentCanvas._createCanvasElement();\n            layer = new fabric.Layer(canvasEl);\n        } else if (!layer.canvasEl) {\n            layer.canvasEl = new this.parentCanvas._createCanvasElement();\n        }\n        this.layerList.push(layer);\n        layer.parent = this;\n        this.parentCanvas.wrapperEl.insertBefore(layer.canvasEl, upperCanvasEl);\n\n        this.parentCanvas._copyCanvasStyle(upperCanvasEl, layer.canvasEl);\n        this.parentCanvas._applyCanvasStyle(layer.canvasEl);\n\n        this.selectLayer(this.layerList.length - 1);\n    };\n\n    /**\n     * Remove Layer\n     * @param index\n     */\n    LayerManager.prototype.removeLayer = function (index) {\n        if(index < this.layerList.length && this.layerList.length > 1){\n            if(this.layerList[index] === this.currentLayer){\n                if(index === 0){\n                    this.selectLayer(1);\n                }else{\n                    this.selectLayer(index - 1);\n                }\n            }\n            this.parentCanvas.wrapperEl.removeChild(this.layerList[index].canvasEl);\n            this.layerList.splice(index,1);\n        }\n    };\n\n    LayerManager.prototype.upLayer = function (index) {\n        if(index!== this.layerList.length - 1){\n            this.moveLayer(index + 1, index);\n        }\n    };\n\n    /**\n     * Move Layer\n     * @param dest Index\n     * @param src  Index\n     */\n    LayerManager.prototype.moveLayer = function (dest, src) {\n        if(dest == src) {\n            return;\n        }\n        if(dest === this.layerList.length - 1){\n            this.parentCanvas.wrapperEl.insertBefore(this.layerList[src].canvasEl, this.parentCanvas.upperCanvasEl);\n        }else{\n            this.parentCanvas.wrapperEl.insertBefore(this.layerList[src].canvasEl, this.layerList[dest].canvasEl);\n        }\n        this.layerList.splice(dest, 0, this.layerList[src]);\n        if(dest > src){\n            this.layerList.splice(src,1);\n        }else{\n            this.layerList.splice(src + 1,1);\n        }\n    };\n\n    LayerManager.prototype.downLayer = function (index){\n        if(index !== 0){\n            this.moveLayer(index - 1, index);\n        }\n    };\n\n    LayerManager.prototype.showLayer = function (index) {\n        if(index< this.layerList.length){\n            this.layerList[index].canvasEl.style.display = null;\n            for(var i = 0; i < this.layerList[index].objects.length; ++i){\n                this.layerList[index].objects[i].visible = true;\n            }\n            this.layerList[index].visible = true;\n            this.parentCanvas.renderAll();\n        }\n    };\n\n    LayerManager.prototype.hideLayer = function (index) {\n        if(index < this.layerList.length){\n            this.layerList[index].canvasEl.style.display = 'none';\n            for(var i = 0; i < this.layerList[index].objects.length; ++i){\n                this.layerList[index].objects[i].visible = false;\n            }\n            this.layerList[index].visible = false;\n            this.parentCanvas.renderAll();\n            //todo: will cause error in trim-canvas for width is 0\n        }\n    };\n\n    LayerManager.prototype.toggleLayerVisible = function (index) {\n        if(this.layerList[index].visible) {\n            this.hideLayer(index);\n        } else {\n            this.showLayer(index);\n        }\n    };\n    /**\n     * Select Layer\n     * @param index\n     */\n    LayerManager.prototype.selectLayer = function (index) {\n        if(index < this.layerList.length) {\n            this.parentCanvas.deactivateAllWithDispatch();\n            this.parentCanvas.renderAll();\n            this.currentLayer = this.layerList[index];\n            this.parentCanvas.lowerCanvasEl = this.currentLayer.canvasEl;\n            this.parentCanvas.contextContainer = this.currentLayer.canvasEl.getContext('2d');\n            this.parentCanvas._objects = this.currentLayer.objects;\n        }\n    };\n\n    /**\n     *  Reset layers\n     */\n    LayerManager.prototype.clearLayers = function () {\n        this.selectLayer(0);\n        this.showLayer(0);\n        while(this.layerList.length > 1) {\n            this.removeLayer(1);\n        }\n    };\n\n    /**\n     * Make everything into one layer and kill others\n     */\n    LayerManager.prototype.combineAllLayers = function () {\n        this.selectLayer(0);\n        while(this.layerList.length > 1) {\n            this.currentLayer.objects = this.currentLayer.objects.concat(this.layerList[1].objects);\n            this.parentCanvas._objects = this.currentLayer.objects;\n            this.removeLayer(1);\n        }\n    };\n\n    /**\n     * Combine layers\n     * @param layers:Array<Number> index of layers\n     */\n    LayerManager.prototype.combineLayers = function (layers) {\n        this.selectLayer(layers[0]);\n        while(layers.length > 1) {\n            if(layers[1] < this.layerList.length){\n                this.currentLayer.objects = this.currentLayer.objects.concat(this.layerList[layers[1]].objects);\n                this.parentCanvas._objects = this.currentLayer.objects;\n                this.removeLayer(layers[1]);\n            }\n        }\n    };\n\n    fabric.LayerManager = LayerManager;\n})(fabric);\n","/**\n * Created by GreenDou on 16/4/7.\n * Layer Class\n */\n\n(function (fabric) {\n    \"use strict\";\n\n    if(!fabric){\n        return;\n    }\n\n    function Layer (canvasEl, name) {\n        this.canvasEl = canvasEl;\n        this.name = name || '' + Layer.prototype.count++;\n        this.parent = null;\n        this.objects = [];\n        //Use show&hideLayer to set this value,otherwise it won't work\n        this.visible = true;\n    }\n\n    Layer.prototype.count = 1;\n\n    Layer.prototype.resetCount = function () {\n        this.prototype.count = 1;\n    };\n\n    fabric.Layer = Layer;\n})(fabric);","/**\n * Created by greendou on 16/4/11.\n * BaseBrush Override\n */\n\n(function() {\n    \"use strict\";\n    if(!fabric){\n        return;\n    }\n\n    fabric.BaseBrush.prototype.setOptions = function (options) {\n        for (var prop in options) {\n            if(options.hasOwnProperty(prop)) {\n                this[prop] = options[prop];\n            }\n        }\n    }\n\n})();","/**\n * Created by GreenDou on 16/4/11.\n * Canvas Events Functions\n */\n\n(function () {\n    \"use strict;\"\n    if(!fabric){\n        return;\n    }\n\n    fabric.Canvas.prototype._bindEvents = function () {\n        this._onMouseDown = this._onMouseDown.bind(this);\n        this._onMouseMove = this._onMouseMove.bind(this);\n        this._onMouseUp = this._onMouseUp.bind(this);\n        this._onMouseOut = this._onMouseOut.bind(this);\n        this._onResize = this._onResize.bind(this);\n        this._onGesture = this._onGesture.bind(this);\n        this._onDrag = this._onDrag.bind(this);\n        this._onShake = this._onShake.bind(this);\n        this._onLongPress = this._onLongPress.bind(this);\n        this._onOrientationChange = this._onOrientationChange.bind(this);\n        this._onMouseWheel = this._onMouseWheel.bind(this);\n    };\n\n    fabric.Canvas.prototype._onMouseOut = function (e) {\n        if(this.isDrawingMode) {\n            this.clearContext(this.contextCursor);\n        }\n    };\n})();","/**\n * Created by GreenDou on 16/4/7.\n * Canvas Class Override\n */\n\n(function (fabric) {\n    \"use strict\";\n    if (!fabric) {\n        return;\n    }\n\n    fabric.Canvas.prototype.initialize = function (el, options) {\n        options || (options = {});\n\n        this._initStatic(el, options);\n        this._initInteractive();\n        this._createCacheCanvas();\n\n        this.layerManager = new fabric.LayerManager(this);\n    };\n\n    fabric.Canvas.prototype._initInteractive = function() {\n        this._currentTransform = null;\n        this._groupSelector = null;\n        this._initWrapperElement();\n        this._createUpperCanvas();\n        this._initEventListeners();\n\n        //todo: fix it for iPad\n        //this._initRetinaScaling();\n\n        this._createCursorCanvas();\n\n        this.freeDrawingBrush = fabric.PencilBrush && new fabric.PencilBrush(this);\n\n        this.calcOffset();\n    };\n\n    fabric.Canvas.prototype.renderAll = function () {\n        var canvasToDrawOn = this.contextContainer, objsToRender;\n\n        if (this.contextTop && this.selection && !this._groupSelector) {\n            this.clearContext(this.contextTop);\n        }\n\n        this.clearContext(canvasToDrawOn);\n\n        this.fire('before:render');\n\n        if (this.clipTo) {\n            fabric.util.clipContext(this, canvasToDrawOn);\n        }\n        this._renderBackground(canvasToDrawOn);\n\n        canvasToDrawOn.save();\n        objsToRender = this._chooseObjectsToRender();\n        //apply viewport transform once for all rendering process\n        canvasToDrawOn.transform.apply(canvasToDrawOn, this.viewportTransform);\n        this._renderObjects(canvasToDrawOn, objsToRender);\n        this.preserveObjectStacking || this._renderObjects(canvasToDrawOn, [this.getActiveGroup()]);\n        canvasToDrawOn.restore();\n\n        if (!this.controlsAboveOverlay && this.interactive) {\n            this.drawControls(canvasToDrawOn);\n        }\n        if (this.clipTo) {\n            canvasToDrawOn.restore();\n        }\n        this._renderOverlay(canvasToDrawOn);\n        if (this.controlsAboveOverlay && this.interactive) {\n            this.drawControls(canvasToDrawOn);\n        }\n\n        this.fire('after:render');\n        return this;\n    };\n\n    fabric.Canvas.prototype.clear = function () {\n        this.layerManager.clearLayers();\n        this._objects.length = 0;\n        if (this.discardActiveGroup) {\n            this.discardActiveGroup();\n        }\n        if (this.discardActiveObject) {\n            this.discardActiveObject();\n        }\n        this.clearContext(this.contextContainer);\n        if (this.contextTop) {\n            this.clearContext(this.contextTop);\n        }\n        this.fire('canvas:cleared');\n        this.renderAll();\n        return this;\n    };\n\n    fabric.Canvas.prototype._createCursorCanvas = function () {\n        this.cursorCanvasEl = this._createCanvasElement();\n        //this.cursorCanvasEl.setAttribute('width', this.width);\n        //this.cursorCanvasEl.setAttribute('height', this.height);\n\n        this.wrapperEl.appendChild(this.cursorCanvasEl);\n\n        this._copyCanvasStyle(this.lowerCanvasEl, this.cursorCanvasEl);\n        this._applyCanvasStyle(this.cursorCanvasEl);\n        this.cursorCanvasEl.style.pointerEvents = \"none\";\n\n        this.contextCursor = this.cursorCanvasEl.getContext('2d');\n    };\n\n    fabric.Canvas.prototype._onMouseMoveInDrawingMode = function (e) {\n        var ivt = fabric.util.invertTransform(this.viewportTransform),\n            pointer = fabric.util.transformPoint(this.getPointer(e, true), ivt);\n        if (this._isCurrentlyDrawing) {\n            this.freeDrawingBrush.onMouseMove(pointer);\n        }\n        if (this.freeDrawingBrush.cursorRenderer) {\n            this.freeDrawingBrush.cursorRender(pointer);\n        }\n\n        this.setCursor(this.freeDrawingCursor);\n        this.fire('mouse:move', {e: e});\n\n        var target = this.findTarget(e);\n        if (typeof target !== 'undefined') {\n            target.fire('mousemove', {e: e, target: target});\n        }\n    };\n\n    fabric.Canvas.prototype.setFreeDrawingBrush = function (brush, options) {\n        var myself = this;\n        this.clearContext(this.contextTop);\n        switch (brush) {\n            case 'eraser':\n                if (this.freeDrawingBrush\n                    && this.freeDrawingBrush instanceof fabric.EraserBrush) {\n                    this.freeDrawingBrush.setOptions(options);\n                } else {\n                    this.freeDrawingBrush = new fabric.EraserBrush(this, options);\n                }\n                break;\n            case 'rotation':\n                if(this.rotationPoint) {\n                    options.point = {\n                        x: this.rotationPoint.x,\n                        y: this.rotationPoint.y\n                    };\n                }\n                if (this.freeDrawingBrush\n                    && this.freeDrawingBrush instanceof fabric.PointBrush) {\n                    this.freeDrawingBrush.setOptions(options);\n                } else {\n                    this.freeDrawingBrush = new fabric.PointBrush(this, function (point) {\n                        myself.rotationPoint = {\n                            x: point.x,\n                            y: point.y\n                        }\n                    }, options);\n                }\n                if(this.rotationPoint) {\n                    this.freeDrawingBrush.renderPoint();\n                }\n                break;\n            case 'pencil':\n            default :\n                if (!(this.freeDrawingBrush\n                    && this.freeDrawingBrush instanceof fabric.PencilBrush)) {\n                    this.freeDrawingBrush = new fabric.PencilBrush(myself);\n                }\n                for (var prop in options) {\n                    if (options.hasOwnProperty(prop)) {\n                        this.freeDrawingBrush[prop] = options[prop];\n                    }\n                }\n        }\n    };\n\n    fabric.Canvas.prototype.setDrawingMode = function (flag) {\n        if (!this.freeDrawingBrush || this.isDrawingMode === flag) {\n            return;\n        }\n\n        this.clearContext(this.contextTop);\n        if (flag) {\n            this.isDrawingMode = true;\n            this.upperCanvasEl.addEventListener('mouseout', this._onMouseOut);\n        } else {\n            this.isDrawingMode = false;\n            this.upperCanvasEl.removeEventListener('mouseout', this._onMouseOut);\n        }\n    }\n\n})(fabric);\n","/**\n * Created by GreenDou on 16/4/14.\n * Pencil Brush Override\n */\n(function() {\n    \"use strict\";\n    if(!fabric){\n        return;\n    }\n\n    fabric.PencilBrush.prototype.initialize = function (canvas) {\n        this.canvas = canvas;\n        this._points = [ ];\n\n        //cursor\n        this.canvas.freeDrawingCursor = 'none';\n        this.cursorRenderer = new fabric.CursorRenderer(this.canvas.cursorCanvasEl, this);\n    };\n\n    fabric.PencilBrush.prototype._prepareForDrawing = function(pointer) {\n\n        var p = new fabric.Point(pointer.x, pointer.y);\n\n        this._reset();\n        this._addPoint(p);\n\n        this.canvas.contextTop.moveTo(p.x, p.y);\n        this.cursorRenderer.prepareForRender();\n    };\n\n    fabric.PencilBrush.prototype.cursorRender = function (pointer) {\n        this.canvas.clearContext(this.canvas.contextCursor);\n        this.cursorRenderer.renderCircle(pointer.x, pointer.y);\n    };\n\n})();\n","!function () {\n    'use strict';\n    window.Painter = {\n\n        init: function (width, height) {\n            var $painterContent = $('.painter-content'),\n                $painterCanvas = $('#painter-canvas'),\n                $painterContainer = $('#painter-container'),\n                myself = this;\n\n            this.$painterContent = $painterContent;\n            this.$btnPencil = $('.btn-pencil');\n            this.$btnPointer = $('.btn-pointer');\n\n            //todo: use relative width&height!\n            if (!width) {\n                width = $painterContent.width() - $('.painter-left-buttons').width() - $('.painter-right-buttons').width() - 46;\n                height = $painterContent.height() - $('.painter-properties').height() - 26;\n            }\n            this.width = width;\n            this.height = height;\n            $painterCanvas.attr('height', height);\n            $painterCanvas.attr('width', width);\n            var canvas = new fabric.Canvas('painter-canvas');\n            Painter.canvas = canvas;\n            canvas.enableRetinaScaling = false;\n\n            $painterContainer.css('visibility', 'visible');\n            $painterContainer.hide();\n\n            //init vue\n\n            this.vm = new Vue({\n                el: '#painter-container',\n                data: {\n                    width: 10,\n                    content: '',\n                    type: 'object',\n                    color: ''\n                },\n                watch: {\n                    'content': function (value) {\n                        var object = canvas.getActiveObject();\n                        if (!object) return;\n\n                        object.set('text', value).setCoords();\n                        canvas.renderAll();\n                    },\n                    'width': function (value) {\n                        var styleName = 'strokeWidth';\n                        value = parseInt(value, 10);\n                        if (canvas.freeDrawingBrush) {\n                            canvas.freeDrawingBrush.width = value || 15;\n                        }\n                        var object = canvas.getActiveObject();\n                        if (!object) return;\n\n                        if(this.type === 'text') {\n                            styleName = 'fontSize';\n                        }\n                        if (object.setSelectionStyles && object.isEditing) {\n                            var style = { };\n                            style[styleName] = value;\n                            object.setSelectionStyles(style);\n                            object.setCoords();\n                        }\n                        else {\n                            object[styleName] = value;\n                        }\n\n                        object.setCoords();\n                        canvas.renderAll();\n                    },\n                    'color': function () {\n                        cur_color = this.color;\n\n                        canvas.freeDrawingBrush.color = cur_color;\n\n                        var activeObject = canvas.getActiveObject(),\n                            activeGroup = canvas.getActiveGroup();\n\n                        if (activeGroup) {\n                            var objectsInGroup = activeGroup.getObjects();\n                            canvas.discardActiveGroup();\n                            objectsInGroup.forEach(function (activeObject) {\n                                if (activeObject.stroke) {\n                                    activeObject.setStroke(cur_color);\n                                } else {\n                                    activeObject.setColor(cur_color);\n                                }\n                            });\n                        }\n                        else if (activeObject) {\n                            if (activeObject.stroke) {\n                                activeObject.setStroke(cur_color);\n                            } else {\n                                activeObject.setColor(cur_color);\n                            }\n                        }\n                        canvas.renderAll();\n                    }\n                }\n                //methods: {\n                //    setContent: function (event) {\n                //        this.content = event.target._value;\n                //    }\n                //}\n            });\n\n            canvas.on('object:selected', updateScope);\n\n            function updateScope() {\n                var object = canvas.getActiveObject();\n                if (!object) return;\n\n                myself.vm.content = object['text'] || '';\n                if(myself.vm.content !== '') {\n                    myself.vm.type = 'text';\n                    myself.vm.width = object['fontSize'];\n                }else{\n                    myself.vm.type = 'path';\n                    if (canvas.freeDrawingBrush) {\n                        myself.vm.width = object['strokeWidth'];\n                    }\n                }\n            }\n\n\n            function getActiveProp(name) {\n                var object = canvas.getActiveObject();\n                if (!object) return '';\n\n                return object[name] || '';\n            }\n\n            ////init colors\n            function initColors() {\n                //var total = 255 * 255 * 255;\n                var colors =  ['e3135c', 'cd0024', 'f1521e', 'fce932','f5a72e', '8b5430', 'bd0add',\n                    '9016e8', '4b90e0', '437715', '85d036', 'bae98a', '000000', 'ffffff']\n                //for (var i = 0; i < total - 100; i += total / 40) {\n                //    i = parseInt(i);\n                //    var color = i.toString(16);\n                //    while (color.length < 6) {\n                //        color = '0' + color;\n                //    }\n                //    $('.painter-colors-wrap').append(template('template-colors', {color: '#' + color}));\n                //}\n                for (var i = 0; i < colors.length; ++i){\n                    $('.painter-colors-wrap').append(template('template-colors', {color: '#' + colors[i]}));\n                }\n\n            }\n\n            var cur_color = '';\n            initColors();\n\n            $('.painter-btn').on('click', function () {\n                if (!$(this).hasClass('active')) {\n                    $(this).parent().find('.painter-btn').removeClass('active');\n                    $(this).addClass('active');\n                    if ($(this).hasClass('painter-colors')) {\n                        canvas.freeDrawingBrush.color = $(this).attr('data-value');\n                        cur_color = $(this).attr('data-value');\n                        myself.vm.color = cur_color;\n\n                        var activeObject = canvas.getActiveObject(),\n                            activeGroup = canvas.getActiveGroup();\n\n                        if (activeGroup) {\n                            var objectsInGroup = activeGroup.getObjects();\n                            canvas.discardActiveGroup();\n                            objectsInGroup.forEach(function (activeObject) {\n                                if (activeObject.stroke) {\n                                    activeObject.setStroke(cur_color);\n                                } else {\n                                    activeObject.setColor(cur_color);\n                                }\n                            });\n                        }\n                        else if (activeObject) {\n                            if (activeObject.stroke) {\n                                activeObject.setStroke(cur_color);\n                            } else {\n                                activeObject.setColor(cur_color);\n                            }\n                        }\n                        canvas.renderAll();\n                    }\n                }\n            });\n            function addLine() {\n                canvas.add(new fabric.Line([ 50, 100, 200, 200], {\n                    left: Math.random() * myself.width,\n                    top: Math.random() * myself.height,\n                    stroke: cur_color,\n                    strokeWidth: myself.vm.width\n                }));\n            }\n            function addRect(width, height, x, y) {\n                var rect = new fabric.Rect({\n                    top: y,\n                    left: x,\n                    width: width,\n                    height: height,\n                    fill: canvas.freeDrawingBrush.color\n                });\n                canvas.add(rect);\n            }\n\n            function addCircle(radius, x, y) {\n                canvas.add(new fabric.Circle({\n                    left: x,\n                    top: y,\n                    fill: canvas.freeDrawingBrush.color,\n                    radius: 50\n                    //opacity: 0.8\n                }));\n            }\n\n            function addTriangle(width, height, x, y) {\n                canvas.add(new fabric.Triangle({\n                    left: x,\n                    top: y,\n                    fill: canvas.freeDrawingBrush.color,\n                    width: width,\n                    height: height\n                }));\n            }\n\n            function addImage(path, x, y, scale) {\n                fabric.Image.fromURL(path, function (image) {\n                    image.set({\n                        left: x || 0,\n                        top: y || 0,\n                        angle: 0\n                    })\n                        .scale(1)\n                        .setCoords();\n                    Painter.canvas.add(image);\n                    Painter.canvas.renderAll();\n                });\n            }\n\n            Painter.addImage = addImage;\n\n            function addText(x, y) {\n                \"use strict\";\n                var text = '~';\n\n                var textSample = new fabric.Text(text, {\n                    left: x || canvas.getWidth() / 2,\n                    top: y || canvas.getHeight() / 2,\n                    fontFamily: 'Microsoft YaHei',\n                    angle: 0,\n                    fill: canvas.freeDrawingBrush.color,\n                    scaleX: 1,\n                    scaleY: 1,\n                    fontWeight: '',\n                    originX: 'left',\n                    hasRotatingPoint: true,\n                    centerTransform: true\n                });\n\n                Painter.canvas.add(textSample);\n            }\n\n            function removeSelected() {\n                var activeObject = canvas.getActiveObject(),\n                    activeGroup = canvas.getActiveGroup();\n\n                if (activeGroup) {\n                    var objectsInGroup = activeGroup.getObjects();\n                    canvas.discardActiveGroup();\n                    objectsInGroup.forEach(function (object) {\n                        canvas.remove(object);\n                    });\n                }\n                else if (activeObject) {\n                    canvas.remove(activeObject);\n                }\n            }\n\n            function cancelSelected() {\n                    canvas.deactivateAll();\n                    canvas.renderAll();\n                    //canvas.discardActiveObject();\n            }\n\n            function initEvents() {\n                var $btnPencil = myself.$btnPencil,\n                    $btnEraser = $('.btn-eraser'),\n                    $btnRotation = $('.btn-rotation');\n                $('.painter-colors:first-child').click();\n                $btnPencil.on('click', function () {\n                    cancelSelected();\n                    canvas.setFreeDrawingBrush('pencil', {\n                        width: 15,\n                        color: cur_color\n                    });\n                    canvas.setDrawingMode(true);\n                    myself.vm.width = 15;\n                    //canvas.freeDrawingBrush.width=10;\n                    //canvas.freeDrawingBrush.color=cur_color;\n                });\n                $btnEraser.on('click', function () {\n                    cancelSelected();\n                    canvas.setFreeDrawingBrush('eraser', {\n                        width: 15,\n                        color: cur_color\n                    });\n                    canvas.setDrawingMode(true);\n                    myself.vm.width = 15;\n                });\n                $btnRotation.on('click', function () {\n                    cancelSelected();\n                    canvas.setDrawingMode(true);\n                    canvas.setFreeDrawingBrush('rotation', {});\n                });\n                $('.btn-circle').on('click', function () {\n                    myself.$btnPointer.click();\n                    addCircle(100, 100, 100);\n\n                });\n                $('.btn-rect').on('click', function () {\n                    myself.$btnPointer.click();\n                    addRect(100, 100, 100, 100);\n                });\n                $('.btn-line').on('click', function () {\n                    myself.$btnPointer.click();\n                    addLine();\n                });\n                $('.btn-triangle').on('click', function () {\n                    myself.$btnPointer.click();\n                    addTriangle(100, 100, 100, 100);\n                });\n                $('.btn-text').on('click', function () {\n                    myself.$btnPointer.click();\n                    addText(0,0);\n                });\n\n                $btnPencil .click();\n                $('.painter-btn-remove').on('click', removeSelected);\n                myself.$btnPointer.on('click', function () {\n                    canvas.setDrawingMode(false);\n                });\n                $('.painter-btn-close').on('click', function () {\n                    canvas.setDrawingMode(false);\n                    $('#painter-container').hide();\n                });\n                $('.painter-btn-check').on('click', function () {\n                    var result, data, param = {};\n                    //todo: Deal with the End\n                    //canvas.contextContainer.imageSmoothingEnabled = false;\n                    canvas.setDrawingMode(false);\n                    //result = toBase64();\n                    canvas.layerManager.combineAllLayers();\n                    var activeObj = Painter.canvas.getActiveObject();\n                    var activeGroup = canvas.getActiveGroup();\n                    if (activeGroup) {\n                        var objectsInGroup = activeGroup.getObjects();\n                        canvas.discardActiveGroup();\n                        objectsInGroup.forEach(function (object) {\n                            object.active = false;\n                        });\n                    }\n                    if (activeObj) {\n                        activeObj.active = false;\n                    }\n                    canvas.renderAll();\n                    canvas.setZoom(1);\n                    //options.anchorOffsetX = result.rc.x;\n                    //options.anchorOffsetY = result.rc.y;\n\n\n                    data = document.createElement('canvas');\n                    data.width = canvas.lowerCanvasEl.width;\n                    data.height = canvas.lowerCanvasEl.height;\n                    data.getContext('2d').drawImage(canvas.lowerCanvasEl, 0, 0);\n                    param.img = data;\n                    param.src = data.toDataURL();\n                    param.rc = canvas.rotationPoint;\n                    param.name = $('.painter-name').val();\n\n                    if(canvas.callback){\n                        canvas.callback(param);\n                    }\n\n                    $('#painter-container').hide();\n                });\n            }\n\n            initEvents();\n\n            function toBase64() {\n                var result;\n\n                canvas.layerManager.combineAllLayers();\n                var activeObj = Painter.canvas.getActiveObject();\n                var activeGroup = canvas.getActiveGroup();\n                if (activeGroup) {\n                    var objectsInGroup = activeGroup.getObjects();\n                    canvas.discardActiveGroup();\n                    objectsInGroup.forEach(function (object) {\n                        object.active = false;\n                    });\n                }\n                if (activeObj) {\n                    activeObj.active = false;\n                }\n                Painter.canvas.renderAll();\n                Painter.canvas.setZoom(1);\n                var data = canvas.toDataURL('png');\n                var img = document.createElement('img');\n                img.setAttribute('width', width);\n                img.setAttribute('height', height);\n                img.setAttribute('src', data);\n                var c = document.createElement('canvas');\n                c.setAttribute('width', width);\n                c.setAttribute('height', height);\n                var ctx = c.getContext('2d');\n                ctx.drawImage(img, 0, 0, width, height);\n                canvas.setZoom(1);\n\n                result = trimCanvasWithPosition(c, canvas.rotationPoint);\n                return result;\n            }\n        },\n\n        /**\n         * Open image in the canvas\n         * @param img\n         * @param name\n         * @param options\n         */\n        openIn: function (img, name, options) {\n            var width = 0, height = 0,\n                x = this.canvas.width/2,\n                y= this.canvas.height/2;\n            if(options) {\n                width = options.width;\n                height = options.height;\n                this.canvas.rotationPoint = {\n                    x: (width > this.canvas.width)?x:options.rotationCenter.x + (this.canvas.width - width)/ 2,\n                    y: (height > this.canvas.height)?y:options.rotationCenter.y + (this.canvas.height - height)/ 2\n                };\n                this.canvas.callback = options.callback;\n            }\n            this.canvas.clear();\n\n            $('.painter-name').val(name);\n\n            this.canvas.setHeight(this.height);\n            this.canvas.setWidth(this.width);\n            this.canvas.renderAll();\n            this.addImage(img, (this.canvas.width - width)/ 2, (this.canvas.height - height)/ 2);\n\n            this.$btnPencil.click();\n            $('#painter-container').show();\n        },\n\n        destroy: function () {\n            $('#painter-container').hide();\n        }\n    };\n}();\n","/**\n * Created by GreenDou on 16/4/12.\n * Point Brush\n */\n\n(function () {\n\n    /**\n     * PointBrush class\n     * @class fabric.PointBrush\n     * @extends fabric.BaseBrush\n     */\n    fabric.PointBrush = fabric.util.createClass(fabric.BaseBrush,\n        /** @lends fabric.PointBrush.prototype */\n        {\n\n            /**\n             * Constructor\n             * @param {fabric.Canvas} canvas\n             * @param {function} callback\n             * @param options\n             * @return {fabric.PencilBrush} Instance of a pencil brush\n             */\n            initialize: function (canvas, callback, options) {\n                this.canvas = canvas;\n                this.callback = callback;\n                this.canvas.freeDrawingCursor = 'none';\n                this.width = 1;\n\n                for (var prop in options) {\n                    if (options.hasOwnProperty(prop)) {\n                        this[prop] = options[prop];\n                    }\n                }\n                this.cursorRenderer = new fabric.CursorRenderer(this.canvas.cursorCanvasEl, this);\n                this.cursorRenderer.width = this.width;\n            },\n\n            /**\n             * Inovoked on mouse down\n             * @param {Object} pointer\n             */\n            onMouseDown: function (pointer) {\n                this._prepareForDrawing(pointer);\n                this.point = pointer;\n                // capture coordinates immediately\n                // this allows to draw dots (when movement never occurs)\n                //this._captureDrawingPath(pointer);\n                this._render(pointer);\n            },\n\n            /**\n             * Inovoked on mouse move\n             * @param {Object} pointer\n             */\n            onMouseMove: function (pointer) {\n                //this._captureDrawingPath(pointer);\n                // redraw curve\n                // clear top canvas\n                this.canvas.clearContext(this.canvas.contextTop);\n                this.point = pointer;\n                this._render(pointer);\n            },\n\n            /**\n             * Invoked on mouse up\n             */\n            onMouseUp: function () {\n                this._finalizeAndCallback();\n            },\n\n            /**\n             * @private\n             * @param {Object} pointer Actual mouse position related to the canvas.\n             */\n            _prepareForDrawing: function (pointer) {\n\n                this._reset();\n                this.canvas.clearContext(this.canvas.contextTop);\n                this.cursorRenderer.prepareForRender();\n            },\n\n            /**\n             * Clear points array and set contextTop canvas style.\n             * @private\n             */\n            _reset: function () {\n                this._setBrushStyles();\n                this._setShadow();\n            },\n\n            _setBrushStyles: function () {\n                \"use strict\";\n                var ctx = this.canvas.contextTop;\n                ctx.lineWidth = this.width;\n                ctx.lineCap = this.strokeLineCap;\n                ctx.lineJoin = this.strokeLineJoin;\n                if (this.strokeDashArray && fabric.StaticCanvas.supports(\"setLineDash\")) {\n                    ctx.setLineDash(this.strokeDashArray);\n                }\n            },\n\n            /**\n             * Draw a smooth path on the topCanvas using quadraticCurveTo\n             * @private\n             */\n            _render: function (pointer) {\n                var ctx = this.canvas.contextTop,\n                    v = this.canvas.viewportTransform,\n                    x = pointer.x,\n                    y = pointer.y;\n                ctx.lineWidth = 1;\n                ctx.save();\n                ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n                ctx.fillStyle = 'rgba(255,255,255,0.5)';\n                ctx.strokeStyle = 'rgba(0,0,0,0.5)';\n                ctx.beginPath();\n                ctx.arc(x, y, 20, 0, Math.PI * 2);\n                ctx.stroke();\n                ctx.fill();\n                ctx.lineWidth = 1;\n                ctx.moveTo(x, 0);\n                ctx.lineTo(x, this.canvas.height);\n                ctx.stroke();\n                ctx.moveTo(0, y);\n                ctx.lineTo(this.canvas.width, y);\n                ctx.stroke();\n            },\n\n            /**\n             * On mouseup after drawing the path on contextTop canvas\n             * we use the points captured to create an new fabric path object\n             * and add it to the fabric canvas.\n             */\n            _finalizeAndCallback: function () {\n                \"use strict\";\n                if (this.callback) {\n                    this.callback(this.point);\n                }\n            },\n\n            cursorRender: function (pointer) {\n                this.canvas.clearContext(this.canvas.contextCursor);\n                this.cursorRenderer.renderPoint(pointer.x, pointer.y);\n                //this.canvas.contextTop.drawImage(this.canvas.cursorCanvasEl,0,0);\n            },\n\n            renderPoint: function () {\n                \"use strict\";\n                this._render(this.point);\n            }\n\n\n        });\n})();\n","(function () {\n    window.trim_canvas = function (c) {\n        // open new window with trimmed image:\n        return getCanvas(c).canvas;\n    };\n\n    /**\n     * Trim with Position Info\n     * @param c Canvas Context\n     * @param {{x:number,y:number}} rc Rotation Center\n     * @returns {{canvas: *, left: null, top: null, rc: *}}\n     */\n    window.trimCanvasWithPosition = function (c, rc) {\n        \"use strict\";\n        var result = getCanvas(c, rc);\n        if(rc) {\n            rc.x = rc.x - result.bound.left;\n            rc.y = rc.y - result.bound.top;\n        }\n\n        // open new window with trimmed image:\n        return {\n            canvas: result.canvas,\n            left: result.bound.left,\n            top: result.bound.top,\n            rc: rc\n        };\n    };\n\n    function detectBounds(c, rc) {\n        var ctx = c.getContext('2d'),\n            pixels = ctx.getImageData(0, 0, c.width, c.height),\n            l = pixels.data.length,\n            i,\n            bound = {\n                top: null,\n                left: null,\n                right: null,\n                bottom: null\n            },\n            x, y;\n\n        for (i = 0; i < l; i += 4) {\n            if (pixels.data[i + 3] !== 0) {\n                x = (i / 4) % c.width;\n                y = ~~((i / 4) / c.width);\n\n                if (bound.top === null) {\n                    bound.top = y;\n                }\n\n                if (bound.left === null) {\n                    bound.left = x;\n                } else if (x < bound.left) {\n                    bound.left = x;\n                }\n\n                if (bound.right === null) {\n                    bound.right = x;\n                } else if (bound.right < x) {\n                    bound.right = x;\n                }\n\n                if (bound.bottom === null) {\n                    bound.bottom = y;\n                } else if (bound.bottom < y) {\n                    bound.bottom = y;\n                }\n            }\n        }\n\n        if(rc){\n            if (bound.top > rc.y) {\n                bound.top = rc.y;\n            }\n            if (bound.bottom < rc.y) {\n                bound.bottom = rc.y;\n            }\n            if (bound.left > rc.x) {\n                bound.left = rc.x;\n            }\n            if (bound.right < rc.x) {\n                bound.right = rc.x;\n            }\n        }\n\n        bound.top = Math.max(bound.top - 10, 0);\n        bound.bottom = Math.min(bound.bottom + 10, c.height);\n        bound.left = Math.max(bound.left - 10, 0);\n        bound.right = Math.min(bound.right + 10, c.width);\n\n        return bound;\n    }\n\n    function getCanvas (c, rc) {\n        \"use strict\";\n        var copy = document.createElement('canvas').getContext('2d');\n        var bound = detectBounds(c, rc);\n        var trimHeight = bound.bottom - bound.top,\n            trimWidth = bound.right - bound.left;\n\n        copy.imageSmoothingEnabled = false;\n        copy.canvas.width = trimWidth;\n        copy.canvas.height = trimHeight;\n        copy.drawImage(c, bound.left, bound.top, trimWidth, trimHeight,\n            0, 0, trimWidth, trimHeight);\n        return {\n            canvas: copy.canvas,\n            bound: bound\n        };\n    }\n\n})();\n"]}